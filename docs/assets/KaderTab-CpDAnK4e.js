import{r as f,j as e,z as F,L as T,P as V}from"./index-CvVKfhs6.js";import{u as O,a as z}from"./useSupabase-D4DMwtSh.js";import{E as D}from"./ExportImportManager-CxPEVFsK.js";function I({onClose:N,players:j=[]}){const[m,M]=f.useState("4-4-2"),[x,u]=f.useState({}),[r,b]=f.useState([]),[$,P]=f.useState(!1),y={"4-4-2":{name:"4-4-2 Classic",positions:{GK:[{x:50,y:85,id:"gk1"}],CB:[{x:35,y:70,id:"cb1"},{x:65,y:70,id:"cb2"}],LB:[{x:15,y:65,id:"lb1"}],RB:[{x:85,y:65,id:"rb1"}],CM:[{x:35,y:45,id:"cm1"},{x:65,y:45,id:"cm2"}],LM:[{x:20,y:40,id:"lm1"}],RM:[{x:80,y:40,id:"rm1"}],ST:[{x:40,y:20,id:"st1"},{x:60,y:20,id:"st2"}]}},"4-3-3":{name:"4-3-3 Attack",positions:{GK:[{x:50,y:85,id:"gk1"}],CB:[{x:35,y:70,id:"cb1"},{x:65,y:70,id:"cb2"}],LB:[{x:15,y:65,id:"lb1"}],RB:[{x:85,y:65,id:"rb1"}],CDM:[{x:50,y:55,id:"cdm1"}],CM:[{x:30,y:40,id:"cm1"},{x:70,y:40,id:"cm2"}],LW:[{x:20,y:25,id:"lw1"}],RW:[{x:80,y:25,id:"rw1"}],ST:[{x:50,y:15,id:"st1"}]}},"3-5-2":{name:"3-5-2 Control",positions:{GK:[{x:50,y:85,id:"gk1"}],CB:[{x:25,y:70,id:"cb1"},{x:50,y:70,id:"cb2"},{x:75,y:70,id:"cb3"}],LWB:[{x:15,y:45,id:"lwb1"}],RWB:[{x:85,y:45,id:"rwb1"}],CDM:[{x:50,y:50,id:"cdm1"}],CM:[{x:35,y:40,id:"cm1"},{x:65,y:40,id:"cm2"}],ST:[{x:40,y:20,id:"st1"},{x:60,y:20,id:"st2"}]}}};f.useEffect(()=>{b([...j]),u({})},[j]);const L=n=>{M(n),u({}),b([...j])},E=(n,l)=>{if(!l)return;const i={...x};Object.keys(i).forEach(a=>{var d;((d=i[a])==null?void 0:d.id)===l.id&&delete i[a]}),i[n]=l,u(i),b(a=>a.filter(d=>d.id!==l.id))},B=n=>{const l=x[n];if(!l)return;const i={...x};delete i[n],u(i),b(a=>[...a,l])},c=()=>{const l=Object.values(x).length;if(l===0)return{attack:0,midfield:0,defense:0,overall:0};const i=["ST","LW","RW","LF","RF"],a=["CM","CDM","CAM","LM","RM","LWB","RWB"],d=["CB","LB","RB","GK"],v=y[m];let w=0,S=0,C=0;Object.entries(v.positions).forEach(([t,s])=>{const o=s.length;i.includes(t)?w+=o:a.includes(t)?S+=o:d.includes(t)&&(C+=o)});const k=w+S+C;return{attack:Math.round(w/k*100),midfield:Math.round(S/k*100),defense:Math.round(C/k*100),overall:l}},h=n=>n==="GK"?"#10B981":["CB","LB","RB"].includes(n)?"#3B82F6":["CM","CDM","CAM","LM","RM","LWB","RWB"].includes(n)?"#F59E0B":["ST","LW","RW","LF","RF"].includes(n)?"#EF4444":"#6B7280",g=()=>{const n={formation:m,players:x,analysis:c(),exportDate:new Date().toISOString()},l=JSON.stringify(n,null,2),i=new Blob([l],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(i),a.download=`formation-${m}-${new Date().toISOString().split("T")[0]}.json`,a.click(),F.success("Formation exportiert!")},p=c();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-2",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg w-full max-w-4xl modal-content",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"⚽ Formation Visualizer"}),e.jsx("button",{onClick:N,className:"text-text-muted hover:text-text-primary text-2xl transition-colors",children:"×"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Formation auswählen:"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Object.entries(y).map(([n,l])=>e.jsx("button",{onClick:()=>L(n),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${m===n?"bg-primary-green text-white":"bg-bg-tertiary text-text-secondary hover:bg-bg-primary"}`,children:l.name},n))})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative bg-green-600 rounded-lg overflow-hidden",style:{aspectRatio:"2/3"},children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-20 h-20 border-2 border-white rounded-full"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-white rounded-full"}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 w-16 h-12 border-2 border-white"}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 w-16 h-12 border-2 border-white"}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-8 h-2 bg-white"}),e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-8 h-2 bg-white"}),e.jsx("div",{className:"absolute top-1/2 left-0 right-0 h-0.5 bg-white"})]}),Object.entries(y[m].positions).map(([n,l])=>l.map(i=>{const a=x[i.id];return e.jsxs("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer group",style:{left:`${i.x}%`,top:`${i.y}%`},onClick:()=>{a&&B(i.id)},children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-white flex items-center justify-center text-white text-xs font-bold shadow-lg transition-transform group-hover:scale-110",style:{backgroundColor:h(n)},children:a?a.name.slice(0,2).toUpperCase():n}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 text-xs text-white bg-black bg-opacity-50 px-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:a?a.name:`${n} Position`})]},i.id)}))]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-text-primary mb-2",children:["Verfügbare Spieler (",r.length,")"]}),e.jsx("div",{className:"bg-bg-tertiary rounded-lg p-3 max-h-48 overflow-y-auto",children:r.length>0?e.jsx("div",{className:"space-y-2",children:r.map(n=>e.jsxs("div",{className:"p-2 bg-bg-secondary rounded cursor-pointer hover:bg-bg-primary transition-colors",onClick:()=>{const l=y[m],i=Object.entries(l.positions).flatMap(([a,d])=>d.map(v=>({...v,type:a}))).find(a=>!x[a.id]);i?E(i.id,n):F.error("Alle Positionen sind besetzt")},children:[e.jsx("div",{className:"text-sm font-medium text-text-primary",children:n.name}),e.jsxs("div",{className:"text-xs text-text-muted",children:[n.position," • ",n.team]})]},n.id))}):e.jsx("div",{className:"text-center py-4 text-text-muted text-sm",children:"Alle Spieler sind aufgestellt"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-text-primary mb-2",children:"Formation Analyse"}),e.jsxs("div",{className:"bg-bg-tertiary rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Angriff:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[p.attack,"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Mittelfeld:"}),e.jsxs("span",{className:"font-medium text-yellow-600",children:[p.midfield,"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Verteidigung:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[p.defense,"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium border-t border-border-light pt-2",children:[e.jsx("span",{children:"Aufgestellt:"}),e.jsxs("span",{children:[p.overall,"/11"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:g,className:"w-full btn-primary text-sm py-2",disabled:p.overall===0,children:"📋 Formation exportieren"}),e.jsx("button",{onClick:()=>{u({}),b([...j]),F.success("Formation zurückgesetzt")},className:"w-full btn-secondary text-sm py-2",children:"🔄 Zurücksetzen"})]})]})]})]})})})}function q(){const[N,j]=f.useState(null),[m,M]=f.useState(!1),[x,u]=f.useState(!1),{data:r,loading:b,error:$,refetch:P}=O("players","*"),{update:y,remove:L}=z("players"),E={TH:0,IV:1,LV:2,RV:3,ZDM:4,ZM:5,ZOM:6,LM:7,RM:8,LF:9,RF:10,ST:11},B=t=>t==="TH"?"inline-block px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 border border-green-200":["IV","LV","RV","ZDM"].includes(t)?"inline-block px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200":["ZM","ZOM","LM","RM"].includes(t)?"inline-block px-2 py-1 rounded text-xs font-medium bg-yellow-100 text-yellow-800 border border-yellow-200":["LF","RF","ST"].includes(t)?"inline-block px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800 border border-red-200":"inline-block px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200",c=t=>r?r.filter(s=>s.team===t).sort((s,o)=>(E[s.position]||99)-(E[o.position]||99)):[],h=t=>r?r.filter(s=>s.team===t).reduce((s,o)=>s+(o.value||0),0):0,g=t=>`${(t||0).toFixed(1)}M €`,p=t=>{const s="modern-card";return t==="AEK"?`${s} border-l-4 border-blue-400`:t==="Real"?`${s} border-l-4 border-red-400`:t==="Ehemalige"?`${s} border-l-4 border-slate-400`:s},n=()=>{if(!r||r.length===0){alert("Keine Spieler für Report verfügbar");return}const t=r.map(s=>`${s.name} (${s.team}): ${s.goals||0} Tore, ${s.position||"Unbekannt"}, Wert: ${g(s.value||0)}`).join(`
`);alert(`📊 Spieler-Report:

${t}`)},l=()=>{const t=c("AEK").length,s=c("Real").length,o=Math.abs(t-s);if(o<=1)alert("✅ Teams sind bereits ausgeglichen!");else{const R=t>s?"Real Madrid":"AEK Athen";alert(`⚖️ Team-Balance:
${R} benötigt ${o} weitere Spieler für ausgeglichene Teams.`)}},i=()=>{if(!r||r.length<4){alert("🔄 Nicht genügend Spieler für Transfer-Analyse");return}const t=c("AEK"),s=c("Real"),o=[];if(t.length>s.length+2){const R=t.sort((A,K)=>(A.value||0)-(K.value||0))[0];o.push(`🔄 ${R.name} von AEK zu Real transferieren`)}else if(s.length>t.length+2){const R=s.sort((A,K)=>(A.value||0)-(K.value||0))[0];o.push(`🔄 ${R.name} von Real zu AEK transferieren`)}o.length===0&&o.push("✅ Teams sind gut ausbalanciert - keine Transfers nötig"),alert(`🔄 Transfer-Empfehlungen:

${o.join(`
`)}`)},a=t=>t==="AEK"?"text-blue-600":t==="Real"?"text-red-600":t==="Ehemalige"?"text-slate-600":"text-gray-600",d=async t=>{const s=prompt("Spielername:",t.name);if(!(!s||s===t.name))try{await y({name:s},t.id),P()}catch(o){alert("Fehler beim Aktualisieren des Spielers: "+o.message)}},v=async t=>{if(confirm(`Sind Sie sicher, dass Sie ${t.name} löschen möchten?`))try{await L(t.id),P()}catch(s){alert("Fehler beim Löschen des Spielers: "+s.message)}};if(b)return e.jsx(T,{message:"Lade Kader..."});if($)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-accent-red mb-4",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-2xl"})}),e.jsx("p",{className:"text-text-muted mb-4",children:"Fehler beim Laden des Kaders"}),e.jsx("button",{onClick:P,className:"btn-primary",children:"Erneut versuchen"})]});const w=c("AEK"),S=c("Real"),C=c("Ehemalige"),k=[{id:"aek",name:"AEK",displayName:"AEK Athen",players:w,squadValue:h("AEK"),icon:"🔵"},{id:"real",name:"Real",displayName:"Real Madrid",players:S,squadValue:h("Real"),icon:"🔴"},{id:"ehemalige",name:"Ehemalige",displayName:"Ehemalige",players:C,squadValue:h("Ehemalige"),icon:"⚪"}];return e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Kader-Übersicht"}),e.jsxs("p",{className:"text-text-muted",children:[(r==null?void 0:r.length)||0," Spieler insgesamt"]})]}),e.jsxs("div",{className:"modern-card mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"⚡"}),"Kader-Management"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:n,className:"flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx("span",{children:"📊"}),e.jsx("span",{children:"Spieler-Report"})]}),e.jsxs("button",{onClick:l,className:"flex items-center justify-center space-x-2 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx("span",{children:"⚖️"}),e.jsx("span",{children:"Teams ausgleichen"})]}),e.jsxs("button",{onClick:i,className:"flex items-center justify-center space-x-2 bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:[e.jsx("span",{children:"🔄"}),e.jsx("span",{children:"Transfer-Tipps"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center justify-center space-x-2 bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 transition-colors text-sm",children:[e.jsx("span",{children:"⚽"}),e.jsx("span",{children:"Formation Planner"})]}),e.jsxs("button",{onClick:()=>M(!0),className:"flex items-center justify-center space-x-2 bg-orange-600 text-white py-3 px-4 rounded-lg hover:bg-orange-700 transition-colors text-sm",children:[e.jsx("span",{children:"📦"}),e.jsx("span",{children:"Export/Import"})]}),e.jsxs("button",{onClick:()=>{const t=h("AEK")+h("Real")+h("Ehemalige"),s=r!=null&&r.length?t/r.length:0;F.success(`📈 Kader-Analyse:

Gesamtwert: ${g(t)}
Durchschnitt: ${g(s)}
Spieler gesamt: ${(r==null?void 0:r.length)||0}`,{duration:5e3})},className:"flex items-center justify-center space-x-2 bg-teal-600 text-white py-3 px-4 rounded-lg hover:bg-teal-700 transition-colors text-sm",children:[e.jsx("span",{children:"📈"}),e.jsx("span",{children:"Kader-Analyse"})]})]})]}),e.jsx("div",{className:"space-y-4",children:k.map(t=>e.jsxs("div",{className:p(t.name),children:[e.jsx("button",{onClick:()=>j(N===t.id?null:t.id),className:"w-full text-left p-4 focus:outline-none",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold text-lg ${a(t.name)}`,children:t.displayName}),e.jsxs("p",{className:"text-sm text-text-muted",children:[t.players.length," Spieler",t.squadValue>0&&e.jsxs("span",{className:"ml-2",children:["• Kaderwert: ",g(t.squadValue)]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-text-muted",children:t.players.length}),e.jsx("i",{className:`fas fa-chevron-${N===t.id?"up":"down"} transition-transform`})]})]})}),N===t.id&&e.jsx("div",{className:"px-4 pb-4 border-t border-border-light mt-4 pt-4",children:t.players.length>0?e.jsx("div",{className:"grid gap-3",children:t.players.map(s=>e.jsx("div",{className:"bg-bg-tertiary rounded-lg p-3 hover:bg-bg-secondary transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-text-primary",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:B(s.position),children:s.position}),s.staerke&&e.jsxs("span",{className:"text-xs text-text-muted",children:["Stärke: ",s.staerke]}),s.value&&e.jsx("span",{className:"text-xs text-primary-green font-medium",children:g(s.value)})]})]})})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>d(s),className:"text-text-muted hover:text-primary-green transition-colors p-1",title:"Bearbeiten",children:e.jsx("i",{className:"fas fa-edit text-sm"})}),e.jsx("button",{onClick:()=>v(s),className:"text-text-muted hover:text-accent-red transition-colors p-1",title:"Löschen",children:e.jsx("i",{className:"fas fa-trash text-sm"})})]})]})},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:t.icon}),e.jsxs("p",{className:"text-text-muted",children:["Keine Spieler in ",t.displayName]})]})})]},t.id))}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"modern-card text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-green",children:(r==null?void 0:r.length)||0}),e.jsx("div",{className:"text-sm text-text-muted",children:"Gesamt Spieler"})]}),e.jsxs("div",{className:"modern-card text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-accent-orange",children:V.length}),e.jsx("div",{className:"text-sm text-text-muted",children:"Positionen"})]})]}),m&&e.jsx(D,{onClose:()=>M(!1)}),x&&e.jsx(I,{players:r||[],onClose:()=>u(!1)})]})}export{q as default};
