import{s as b,r as N,j as e,z as k}from"./index-DkytnlYx.js";import{u as R}from"./useSupabase-CqXv-Pi8.js";class F{static async submitMatch(n){const{date:a,teama:t="AEK",teamb:l="Real",goalsa:c,goalsb:u,goalslista:x=[],goalslistb:v=[],yellowa:d=0,reda:s=0,yellowb:i=0,redb:p=0,manofthematch:h,editId:r=null}=n;try{const{prizeaek:o,prizereal:m,winner:j,loser:f}=this.calculatePrizeMoney(c,u,d,s,i,p);r&&await this.deleteMatchTransactions(r);const y={date:a,teama:t,teamb:l,goalsa:parseInt(c)||0,goalsb:parseInt(u)||0,goalslista:JSON.stringify(x),goalslistb:JSON.stringify(v),yellowa:parseInt(d)||0,reda:parseInt(s)||0,yellowb:parseInt(i)||0,redb:parseInt(p)||0,manofthematch:h||null,prizeaek:o,prizereal:m},w=await b.insert("matches",y);if(w.error)throw new Error(`Match insert failed: ${w.error.message}`);const S=w.data.id,T=new Date().toISOString().slice(0,10);return c>0&&await this.updatePlayersGoals(x,"AEK"),u>0&&await this.updatePlayersGoals(v,"Real"),h&&await this.updatePlayerOfTheMatchStats(h),await this.processFinancialTransactions({matchId:S,date:T,prizeaek:o,prizereal:m,manofthematch:h,winner:j,loser:f}),await this.decrementBansAfterMatch(),{success:!0,matchId:S,message:`Match ${t} vs ${l} (${c}:${u}) erfolgreich hinzugefügt`}}catch(o){throw console.error("Error in submitMatch:",o),new Error(`Fehler beim Speichern des Matches: ${o.message}`)}}static calculatePrizeMoney(n,a,t,l,c,u){let x=0,v=0,d=null,s=null;return n>a?(d="AEK",s="Real"):n<a&&(d="Real",s="AEK"),d&&s&&(d==="AEK"?(x=1e6-a*5e4-t*2e4-l*5e4,v=-(5e5+n*5e4+c*2e4+u*5e4)):(v=1e6-n*5e4-c*2e4-u*5e4,x=-(5e5+a*5e4+t*2e4+l*5e4))),{prizeaek:x,prizereal:v,winner:d,loser:s}}static async updatePlayersGoals(n,a){for(const t of n)if(!(!t||!t.trim()))try{const l=await b.select("players","goals",{eq:{name:t,team:a}});if(l.data&&l.data.length>0){const u=(l.data[0].goals||0)+1,x=await b.select("players","id",{eq:{name:t,team:a}});x.data&&x.data.length>0&&await b.update("players",{goals:u},x.data[0].id)}}catch(l){console.warn(`Failed to update goals for player ${t}:`,l)}}static async updatePlayerOfTheMatchStats(n){try{const a=await b.select("players","team",{eq:{name:n}});if(!a.data||a.data.length===0){console.warn(`Player ${n} not found for SdS stats`);return}const t=a.data[0].team,l=await b.select("spieler_des_spiels","*",{eq:{name:n,team:t}});if(l.data&&l.data.length>0){const c=l.data[0];await b.update("spieler_des_spiels",{count:c.count+1},c.id)}else await b.insert("spieler_des_spiels",{name:n,team:t,count:1})}catch(a){console.warn(`Failed to update SdS stats for ${n}:`,a)}}static async processFinancialTransactions({matchId:n,date:a,prizeaek:t,prizereal:l,manofthematch:c,winner:u,loser:x}){const v=await this.getTeamFinance("AEK"),d=await this.getTeamFinance("Real");let s=v.balance||0,i=d.balance||0;const p=c?await this.getSdSBonus(c,"AEK"):0,h=c?await this.getSdSBonus(c,"Real"):0;p>0&&(s+=p,await this.insertTransaction({date:a,type:"Bonus SdS",team:"AEK",amount:p,match_id:n,info:"SdS Bonus"}),await this.updateTeamBalance("AEK",s)),h>0&&(i+=h,await this.insertTransaction({date:a,type:"Bonus SdS",team:"Real",amount:h,match_id:n,info:"SdS Bonus"}),await this.updateTeamBalance("Real",i)),t!==0&&(s+=t,s<0&&(s=0),await this.insertTransaction({date:a,type:"Preisgeld",team:"AEK",amount:t,match_id:n,info:"Preisgeld"}),await this.updateTeamBalance("AEK",s)),l!==0&&(i+=l,i<0&&(i=0),await this.insertTransaction({date:a,type:"Preisgeld",team:"Real",amount:l,match_id:n,info:"Preisgeld"}),await this.updateTeamBalance("Real",i)),u&&x&&await this.processEchtgeldAusgleich({date:a,matchId:n,winner:u,loser:x,aekBalance:s,realBalance:i,prizeaek:t,prizereal:l,sdsBonusAek:p>0?1:0,sdsBonusReal:h>0?1:0,manofthematch:c})}static async getTeamFinance(n){const a=await b.select("finances","*",{eq:{team:n}});return a.data&&a.data.length>0?a.data[0]:{balance:0,debt:0}}static async getSdSBonus(n,a){const t=await b.select("players","team",{eq:{name:n}});return t.data&&t.data.length>0&&t.data[0].team===a?1e5:0}static async insertTransaction(n){return await b.insert("transactions",n)}static async updateTeamBalance(n,a){const t=await b.select("finances","id",{eq:{team:n}});return t.data&&t.data.length>0?await b.update("finances",{balance:a},t.data[0].id):await b.insert("finances",{team:n,balance:a,debt:0})}static async processEchtgeldAusgleich({date:n,matchId:a,winner:t,loser:l,aekBalance:c,realBalance:u,prizeaek:x,prizereal:v,sdsBonusAek:d,sdsBonusReal:s,manofthematch:i}){const p=await this.getTeamFinance("AEK"),h=await this.getTeamFinance("Real"),r={AEK:p.debt||0,Real:h.debt||0},o=(E,q,O)=>{let B=E;O&&(B+=1e5);let C=(Math.abs(q)-B)/1e5;return C<0&&(C=0),5+Math.round(C)},m=o(c,x,d),j=o(u,v,s),f=l==="AEK"?m:j,y=r[t],w=r[l],S=Math.min(y,f*1),T=Math.max(0,y-S),z=f*1-S,M=w+Math.max(0,z),A=await b.select("finances","id",{eq:{team:t}});if(A.data&&A.data.length>0&&await b.update("finances",{debt:T},A.data[0].id),z>0){await this.insertTransaction({date:n,type:"Echtgeld-Ausgleich",team:l,amount:Math.max(0,z),match_id:a,info:"Echtgeld-Ausgleich"});const E=await b.select("finances","id",{eq:{team:l}});E.data&&E.data.length>0&&await b.update("finances",{debt:M},E.data[0].id)}S>0&&await this.insertTransaction({date:n,type:"Echtgeld-Ausgleich (getilgt)",team:t,amount:-S,match_id:a,info:"Echtgeld-Ausgleich (getilgt)"})}static async deleteMatchTransactions(n){const a=await b.select("transactions","*",{eq:{match_id:n}});if(a.data)for(const t of a.data)await b.delete("transactions",t.id);await b.delete("matches",n)}static async decrementBansAfterMatch(){try{const n=await b.select("bans","*");if(!n.data)return;for(const a of n.data)if(a.matchesserved<a.totalgames){const t=a.matchesserved+1;await b.update("bans",{matchesserved:t},a.id)}}catch(n){console.warn("Failed to decrement bans:",n)}}}function I(){const{data:g}=R("players","*"),[n,a]=N.useState(!1),[t,l]=N.useState({teama:"AEK",teamb:"Real",date:new Date().toISOString().split("T")[0],goalsa:0,goalsb:0,goalslista:[],goalslistb:[],yellowa:0,reda:0,yellowb:0,redb:0,prizeaek:0,prizereal:0,manofthematch:""}),[c,u]=N.useState(!1),x=(r,o)=>{l(m=>{const j={...m,[r]:o};if(["goalsa","goalsb","yellowa","reda","yellowb","redb"].includes(r)){const f=parseInt(j.goalsa)||0,y=parseInt(j.goalsb)||0,w=parseInt(j.yellowa)||0,S=parseInt(j.reda)||0,T=parseInt(j.yellowb)||0,z=parseInt(j.redb)||0,{prizeaek:M,prizereal:A}=F.calculatePrizeMoney(f,y,w,S,T,z);j.prizeaek=M,j.prizereal=A}return j})},v=async r=>{r.preventDefault(),u(!0);try{const o=t.goalslista.filter(f=>f.trim()).length,m=t.goalslistb.filter(f=>f.trim()).length;if(o>parseInt(t.goalsa))throw new Error(`Die Anzahl der Torschützen für ${t.teama} (${o}) darf nicht größer als die Gesamtanzahl der Tore (${t.goalsa}) sein!`);if(m>parseInt(t.goalsb))throw new Error(`Die Anzahl der Torschützen für ${t.teamb} (${m}) darf nicht größer als die Gesamtanzahl der Tore (${t.goalsb}) sein!`);const j=await F.submitMatch({date:t.date,teama:t.teama.trim(),teamb:t.teamb.trim(),goalsa:parseInt(t.goalsa)||0,goalsb:parseInt(t.goalsb)||0,goalslista:t.goalslista.filter(f=>f.trim()),goalslistb:t.goalslistb.filter(f=>f.trim()),yellowa:parseInt(t.yellowa)||0,reda:parseInt(t.reda)||0,yellowb:parseInt(t.yellowb)||0,redb:parseInt(t.redb)||0,manofthematch:t.manofthematch||null});l({teama:"AEK",teamb:"Real",date:new Date().toISOString().split("T")[0],goalsa:0,goalsb:0,goalslista:[],goalslistb:[],yellowa:0,reda:0,yellowb:0,redb:0,prizeaek:0,prizereal:0,manofthematch:""}),a(!1),k.success(j.message)}catch(o){console.error("Match submission error:",o),k.error(o.message||"Fehler beim Hinzufügen des Spiels")}finally{u(!1)}},d=t.teama&&t.teamb&&t.date,s=r=>g?g.filter(o=>o.team===r):[],i=r=>{const o=r==="AEK"?"goalslista":"goalslistb";l(m=>({...m,[o]:[...m[o],""]}))},p=(r,o)=>{const m=r==="AEK"?"goalslista":"goalslistb";l(j=>({...j,[m]:j[m].filter((f,y)=>y!==o)}))},h=(r,o,m)=>{const j=r==="AEK"?"goalslista":"goalslistb";l(f=>({...f,[j]:f[j].map((y,w)=>w===o?m:y)}))};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neues Spiel hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Fügen Sie ein neues Spiel zur Datenbank hinzu."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚽"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Spiel hinzufügen"}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um ein neues Spiel zu erfassen."}),e.jsxs("button",{onClick:()=>a(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neues Spiel erfassen"]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neues Spiel"}),e.jsx("button",{onClick:()=>a(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:c,children:"×"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Heimteam *"}),e.jsxs("select",{value:t.teama,onChange:r=>x("teama",r.target.value),className:"form-input",required:!0,disabled:c,children:[e.jsx("option",{value:"AEK",children:"AEK Athen"}),e.jsx("option",{value:"Real",children:"Real Madrid"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Gastteam *"}),e.jsxs("select",{value:t.teamb,onChange:r=>x("teamb",r.target.value),className:"form-input",required:!0,disabled:c,children:[e.jsx("option",{value:"Real",children:"Real Madrid"}),e.jsx("option",{value:"AEK",children:"AEK Athen"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Datum *"}),e.jsx("input",{type:"date",value:t.date,onChange:r=>x("date",r.target.value),className:"form-input",required:!0,disabled:c})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Tore Heimteam"}),e.jsx("input",{type:"number",min:"0",value:t.goalsa,onChange:r=>x("goalsa",r.target.value),className:"form-input",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Tore Gastteam"}),e.jsx("input",{type:"number",min:"0",value:t.goalsb,onChange:r=>x("goalsb",r.target.value),className:"form-input",disabled:c})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"⚽ Torschützen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"AEK Athen"}),e.jsx("button",{type:"button",onClick:()=>i("AEK"),className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded",disabled:c,children:"+ Torschütze"})]}),t.goalslista.map((r,o)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r,onChange:m=>h("AEK",o,m.target.value),className:"form-input text-sm flex-1",disabled:c,children:[e.jsx("option",{value:"",children:"Spieler wählen"}),s("AEK").map(m=>e.jsx("option",{value:m.name,children:m.name},m.id))]}),e.jsx("button",{type:"button",onClick:()=>p("AEK",o),className:"text-red-600 hover:text-red-800 p-1",disabled:c,children:"×"})]},o)),t.goalslista.length===0&&e.jsx("p",{className:"text-xs text-text-muted",children:"Keine Torschützen hinzugefügt"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium",children:"Real Madrid"}),e.jsx("button",{type:"button",onClick:()=>i("Real"),className:"text-xs bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded",disabled:c,children:"+ Torschütze"})]}),t.goalslistb.map((r,o)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r,onChange:m=>h("Real",o,m.target.value),className:"form-input text-sm flex-1",disabled:c,children:[e.jsx("option",{value:"",children:"Spieler wählen"}),s("Real").map(m=>e.jsx("option",{value:m.name,children:m.name},m.id))]}),e.jsx("button",{type:"button",onClick:()=>p("Real",o),className:"text-red-600 hover:text-red-800 p-1",disabled:c,children:"×"})]},o)),t.goalslistb.length===0&&e.jsx("p",{className:"text-xs text-text-muted",children:"Keine Torschützen hinzugefügt"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"🟨🟥 Karten"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Heimteam"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟨 Gelbe Karten"}),e.jsx("input",{type:"number",min:"0",value:t.yellowa,onChange:r=>x("yellowa",r.target.value),className:"form-input",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟥 Rote Karten"}),e.jsx("input",{type:"number",min:"0",value:t.reda,onChange:r=>x("reda",r.target.value),className:"form-input",disabled:c})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium",children:"Gastteam"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟨 Gelbe Karten"}),e.jsx("input",{type:"number",min:"0",value:t.yellowb,onChange:r=>x("yellowb",r.target.value),className:"form-input",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟥 Rote Karten"}),e.jsx("input",{type:"number",min:"0",value:t.redb,onChange:r=>x("redb",r.target.value),className:"form-input",disabled:c})]})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"💰 Preisgelder (automatisch berechnet)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Preisgeld AEK (€)"}),e.jsx("input",{type:"number",value:t.prizeaek,className:"form-input bg-gray-100",placeholder:"Automatisch berechnet",disabled:!0,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Preisgeld Real (€)"}),e.jsx("input",{type:"number",value:t.prizereal,className:"form-input bg-gray-100",placeholder:"Automatisch berechnet",disabled:!0,readOnly:!0})]})]}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Basierend auf Ergebnis und Karten: Gewinner 1M€ - (Verlierer-Tore × 50k€) - (Karten × 20k€/50k€)"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"⭐ Spieler des Spiels"}),e.jsxs("select",{value:t.manofthematch,onChange:r=>x("manofthematch",r.target.value),className:"form-input",disabled:c,children:[e.jsx("option",{value:"",children:"Keinen Spieler auswählen"}),g&&g.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.team," - ",r.position,")"]},r.id))]}),!g||g.length===0&&e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Keine Spieler verfügbar. Bitte fügen Sie erst Spieler hinzu."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:c,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!d||c,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Nach dem Hinzufügen können Sie das Spiel in der Spiele-Übersicht einsehen und bearbeiten."})]})]})})]})}const K=[{value:"Gelb-Rote Karte",label:"Gelb-Rote Karte",duration:1,icon:"🟨🟥"},{value:"Rote Karte",label:"Rote Karte",duration:2,icon:"🟥"},{value:"Verletzung",label:"Verletzung",duration:3,icon:"🏥"},{value:"Unsportlichkeit",label:"Unsportlichkeit",duration:1,icon:"⚠️"}];function G(){const{data:g}=R("players","*"),[n,a]=N.useState(!1),[t,l]=N.useState({player_id:"",type:"",reason:""}),[c,u]=N.useState(!1),x=(i,p)=>{l(h=>({...h,[i]:p}))},v=async i=>{var p;i.preventDefault(),u(!0);try{const h=g==null?void 0:g.find(f=>f.id===parseInt(t.player_id)),r=K.find(f=>f.value===t.type);if(!h)throw new Error("Spieler nicht gefunden");if(!r)throw new Error("Sperrart nicht gefunden");const m=(p=(await b.select("bans","*",{eq:{player_id:h.id}})).data)==null?void 0:p.find(f=>(f.matchesserved||0)<(f.totalgames||0));if(m)throw new Error(`Spieler "${h.name}" ist bereits gesperrt (${m.totalgames-m.matchesserved} Spiele verbleibend)`);const j=await b.insert("bans",{player_id:h.id,team:h.team,type:r.value,totalgames:r.duration,matchesserved:0,reason:t.reason||r.value,created_at:new Date().toISOString()});if(j.error)throw new Error(`Ban insert failed: ${j.error.message}`);l({player_id:"",type:"",reason:""}),a(!1),k.success(`Sperre für "${h.name}" erfolgreich hinzugefügt!`)}catch(h){console.error("Ban submission error:",h),k.error(h.message||"Fehler beim Hinzufügen der Sperre")}finally{u(!1)}},d=t.player_id&&t.type,s=K.find(i=>i.value===t.type);return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neue Sperre hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Erstellen Sie eine neue Spielersperre in der Datenbank."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🚫"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Sperre hinzufügen"}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um eine neue Spielersperre zu erfassen."}),e.jsxs("button",{onClick:()=>a(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neue Sperre erfassen"]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neue Sperre"}),e.jsx("button",{onClick:()=>a(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:c,children:"×"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Spieler *"}),e.jsxs("select",{value:t.player_id,onChange:i=>x("player_id",i.target.value),className:"form-input",required:!0,disabled:c,children:[e.jsx("option",{value:"",children:"Spieler wählen"}),g&&g.map(i=>e.jsxs("option",{value:i.id,children:[i.name," (",i.team," - ",i.position,")"]},i.id))]}),!g||g.length===0&&e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Keine Spieler verfügbar. Bitte fügen Sie erst Spieler hinzu."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Sperrart *"}),e.jsxs("select",{value:t.type,onChange:i=>x("type",i.target.value),className:"form-input",required:!0,disabled:c,children:[e.jsx("option",{value:"",children:"Sperrart wählen"}),K.map(i=>e.jsxs("option",{value:i.value,children:[i.icon," ",i.label," (",i.duration," Spiel",i.duration!==1?"e":"",")"]},i.value))]}),s&&e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Sperre dauert ",s.duration," Spiel",s.duration!==1?"e":""]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Zusätzlicher Grund (optional)"}),e.jsx("input",{type:"text",value:t.reason,onChange:i=>x("reason",i.target.value),className:"form-input",placeholder:"Weitere Details zur Sperre...",disabled:c})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:c,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!d||c||!g||g.length===0,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Sperrarten"}),e.jsx("div",{className:"space-y-2",children:K.map(i=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-bg-secondary rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:i.icon}),e.jsx("span",{className:"font-medium text-text-primary",children:i.label})]}),e.jsxs("span",{className:"text-sm text-text-muted",children:[i.duration," Spiel",i.duration!==1?"e":""]})]},i.value))})]}),e.jsx("div",{className:"mt-6 modern-card bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-yellow-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-yellow-700 text-sm",children:"Nach dem Hinzufügen können Sie die Sperre in der Sperren-Übersicht einsehen und verwalten."})]})]})})]})}const D=[{value:"TH",label:"Torwart (TH)"},{value:"IV",label:"Innenverteidiger (IV)"},{value:"AV",label:"Außenverteidiger (AV)"},{value:"ZM",label:"Zentrales Mittelfeld (ZM)"},{value:"OM",label:"Offensives Mittelfeld (OM)"},{value:"ST",label:"Stürmer (ST)"}],P=[{value:"AEK",label:"AEK Athen",color:"blue"},{value:"Real",label:"Real Madrid",color:"red"},{value:"Ehemalige",label:"Ehemalige",color:"gray"}];function H(){const[g,n]=N.useState(!1),[a,t]=N.useState({name:"",team:"",position:"",goals:0,value:0,status:"active"}),[l,c]=N.useState(!1),u=(d,s)=>{t(i=>({...i,[d]:s}))},x=async d=>{d.preventDefault(),c(!0);try{const s=await b.select("players","*",{eq:{name:a.name.trim(),team:a.team.trim()}});if(s.data&&s.data.length>0)throw new Error(`Spieler "${a.name}" existiert bereits im Team "${a.team}"`);const i=await b.insert("players",{name:a.name.trim(),team:a.team.trim(),position:a.position.trim().toUpperCase(),goals:parseInt(a.goals)||0,value:parseFloat(a.value)||0,status:a.status||"active",created_at:new Date().toISOString()});if(i.error)throw new Error(`Player insert failed: ${i.error.message}`);t({name:"",team:"",position:"",goals:0,value:0,status:"active"}),n(!1),k.success(`Spieler "${a.name}" erfolgreich hinzugefügt!`)}catch(s){console.error("Player submission error:",s),k.error(s.message||"Fehler beim Hinzufügen des Spielers")}finally{c(!1)}},v=a.name&&a.team&&a.position&&a.value!=="";return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neuen Spieler hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Fügen Sie einen neuen Spieler zur Datenbank hinzu."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"👤"}),e.jsxs("h4",{className:"text-lg font-medium text-text-primary mb-2",children:[e.jsx("i",{className:"fas fa-user-plus mr-2"}),"Spieler hinzufügen"]}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um einen neuen Spieler zu erfassen."}),e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neuen Spieler erfassen"]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neuer Spieler"}),e.jsx("button",{onClick:()=>n(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:l,children:"×"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Spielername *"}),e.jsx("input",{type:"text",value:a.name,onChange:d=>u("name",d.target.value),className:"form-input",placeholder:"z.B. Max Mustermann",required:!0,disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Team *"}),e.jsxs("select",{value:a.team,onChange:d=>u("team",d.target.value),className:"form-input",required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Team wählen"}),P.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Position *"}),e.jsxs("select",{value:a.position,onChange:d=>u("position",d.target.value),className:"form-input",required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Position wählen"}),D.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Anzahl Tore"}),e.jsx("input",{type:"number",min:"0",value:a.goals,onChange:d=>u("goals",d.target.value),className:"form-input",placeholder:"0",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Marktwert (Millionen €) *"}),e.jsx("input",{type:"number",min:"0",step:"0.1",value:a.value,onChange:d=>u("value",d.target.value),className:"form-input",placeholder:"0.0",disabled:l}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Marktwert in Millionen Euro (z.B. 1.5 für 1.5M €)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:l,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!v||l,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Teams"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:P.map(d=>e.jsxs("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:[e.jsxs("span",{className:`font-medium ${d.color==="blue"?"text-blue-600":d.color==="red"?"text-red-600":"text-gray-600"}`,children:[d.color==="blue"?"🔵":d.color==="red"?"🔴":"⚫"," ",d.label]}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["(",d.value,")"]})]},d.value))})]}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Positionen"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:D.map(d=>e.jsx("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:e.jsx("span",{className:"font-medium text-text-primary text-sm",children:d.label})},d.value))})]}),e.jsx("div",{className:"mt-6 modern-card bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-green-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-green-700 text-sm",children:"Nach dem Hinzufügen können Sie den Spieler in der Kader-Übersicht einsehen und verwalten."})]})]})})]})}const $=[{value:"Preisgeld",label:"Preisgeld",icon:"🏆"},{value:"Strafe",label:"Strafe",icon:"📉"},{value:"Spielerkauf",label:"Spielerkauf",icon:"👤"},{value:"Spielerverkauf",label:"Spielerverkauf",icon:"💰"},{value:"Echtgeld-Ausgleich",label:"Echtgeld-Ausgleich",icon:"💳"},{value:"SdS Bonus",label:"Spieler des Spiels Bonus",icon:"⭐"},{value:"Sonstiges",label:"Sonstiges",icon:"📈"}],_=[{value:"AEK",label:"AEK Athen",color:"blue"},{value:"Real",label:"Real Madrid",color:"red"}];function V(){R("finances","*");const[g,n]=N.useState(!1),[a,t]=N.useState({team:"",type:"",amount:"",info:"",date:new Date().toISOString().split("T")[0]}),[l,c]=N.useState(!1),u=(s,i)=>{t(p=>({...p,[s]:i}))},x=async s=>{s.preventDefault(),c(!0);try{const i=parseFloat(a.amount),p=await b.insert("transactions",{date:a.date,type:a.type.trim(),team:a.team.trim(),amount:i,info:a.info.trim(),match_id:null});if(p.error)throw new Error(`Transaction insert failed: ${p.error.message}`);await v(a.team.trim(),a.type.trim(),i),t({team:"",type:"",amount:"",info:"",date:new Date().toISOString().split("T")[0]}),n(!1),k.success("Transaktion erfolgreich hinzugefügt!")}catch(i){console.error("Transaction submission error:",i),k.error(i.message||"Fehler beim Hinzufügen der Transaktion")}finally{c(!1)}},v=async(s,i,p)=>{try{const h=await b.select("finances","*",{eq:{team:s}});let r=h.data&&h.data.length>0?h.data[0]:{team:s,balance:0,debt:0},o={};if(i==="Echtgeld-Ausgleich")o.debt=(r.debt||0)+p;else{let m=(r.balance||0)+p;m<0&&(m=0),o.balance=m}r.id?await b.update("finances",o,r.id):await b.insert("finances",{team:s,balance:o.balance||0,debt:o.debt||0})}catch(h){console.warn("Failed to update finances:",h)}},d=a.team&&a.type&&a.amount&&a.date;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neue Transaktion hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Erfassen Sie eine neue finanzielle Transaktion."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"💰"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Transaktion hinzufügen"}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um eine neue Transaktion zu erfassen."}),e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neue Transaktion erfassen"]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neue Transaktion"}),e.jsx("button",{onClick:()=>n(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:l,children:"×"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Team *"}),e.jsxs("select",{value:a.team,onChange:s=>u("team",s.target.value),className:"form-input",required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Team wählen"}),_.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Transaktionsart *"}),e.jsxs("select",{value:a.type,onChange:s=>u("type",s.target.value),className:"form-input",required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Typ wählen"}),$.map(s=>e.jsxs("option",{value:s.value,children:[s.icon," ",s.label]},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Betrag (€) *"}),e.jsx("input",{type:"number",step:"0.01",value:a.amount,onChange:s=>u("amount",s.target.value),className:"form-input",placeholder:"0.00",required:!0,disabled:l}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Negative Werte für Ausgaben, positive für Einnahmen"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Beschreibung"}),e.jsx("input",{type:"text",value:a.info,onChange:s=>u("info",s.target.value),className:"form-input",placeholder:"Zusätzliche Informationen...",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Datum *"}),e.jsx("input",{type:"date",value:a.date,onChange:s=>u("date",s.target.value),className:"form-input",required:!0,disabled:l})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:l,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!d||l,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Transaktionsarten"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:$.map(s=>e.jsxs("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:s.icon}),e.jsx("span",{className:"font-medium text-text-primary",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Teams"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:_.map(s=>e.jsxs("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:[e.jsxs("span",{className:`font-medium ${s.color==="blue"?"text-blue-600":"text-red-600"}`,children:[s.color==="blue"?"🔵":"🔴"," ",s.label]}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["(",s.value,")"]})]},s.value))})]}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Nach dem Hinzufügen können Sie die Transaktion in der Finanzen-Übersicht einsehen."})]})]})})]})}function U(){const[g,n]=N.useState("matches"),a=[{id:"matches",label:"Spiele hinzufügen",icon:"fas fa-futbol"},{id:"bans",label:"Sperren hinzufügen",icon:"fas fa-ban"},{id:"players",label:"Spieler hinzufügen",icon:"fas fa-user-plus"},{id:"transactions",label:"Transaktionen hinzufügen",icon:"fas fa-euro-sign"}],t=()=>{switch(g){case"matches":return e.jsx(I,{});case"bans":return e.jsx(G,{});case"players":return e.jsx(H,{});case"transactions":return e.jsx(V,{});default:return e.jsx(I,{})}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 bg-bg-secondary border-b border-border-light",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-1",children:"Verwaltung"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Hinzufügen und verwalten von Daten"})]}),e.jsx("div",{className:"bg-bg-secondary border-b border-border-light",children:e.jsx("div",{className:"flex overflow-x-auto",children:a.map(l=>e.jsxs("button",{onClick:()=>n(l.id),className:`flex-shrink-0 px-4 py-3 text-sm font-medium transition-colors whitespace-nowrap ${g===l.id?"text-primary border-b-2 border-primary bg-bg-primary":"text-text-secondary hover:text-text-primary hover:bg-bg-hover"}`,children:[e.jsx("i",{className:`${l.icon} mr-2`}),l.label]},l.id))})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:t()})]})}export{U as default};
