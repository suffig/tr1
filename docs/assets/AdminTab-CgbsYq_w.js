import{s as u,r as S,j as e,z as A}from"./index-C6wdIwoU.js";import{u as C}from"./useSupabase-C-DBL11f.js";class G{static async submitMatch(r){const{date:t,teama:a="AEK",teamb:i="Real",goalsa:d,goalsb:x,goalslista:p=[],goalslistb:j=[],ownGoalsA:c=0,ownGoalsB:s=0,yellowa:n=0,reda:f=0,yellowb:h=0,redb:v=0,manofthematch:y,editId:w=null}=r;try{const{prizeaek:l,prizereal:o,winner:m,loser:b}=this.calculatePrizeMoney(d,x,n,f,h,v);w&&await this.deleteMatchTransactions(w);const N={date:t,teama:a,teamb:i,goalsa:parseInt(d)||0,goalsb:parseInt(x)||0,goalslista:JSON.stringify(p),goalslistb:JSON.stringify(j),yellowa:parseInt(n)||0,reda:parseInt(f)||0,yellowb:parseInt(h)||0,redb:parseInt(v)||0,manofthematch:y||null,prizeaek:l,prizereal:o,...c>0||s>0?{owngoals:JSON.stringify({aek:c,real:s})}:{}},k=await u.insert("matches",N);if(k.error)throw new Error(`Match insert failed: ${k.error.message}`);const E=k.data.id,B=new Date().toISOString().slice(0,10);return d>0&&await this.updatePlayersGoals(p,"AEK"),x>0&&await this.updatePlayersGoals(j,"Real"),y&&await this.updatePlayerOfTheMatchStats(y),await this.processFinancialTransactions({matchId:E,date:B,prizeaek:l,prizereal:o,manofthematch:y,winner:m,loser:b}),await this.decrementBansAfterMatch(),{success:!0,matchId:E,message:`Match ${a} vs ${i} (${d}:${x}) erfolgreich hinzugefügt`}}catch(l){throw console.error("Error in submitMatch:",l),new Error(`Fehler beim Speichern des Matches: ${l.message}`)}}static calculatePrizeMoney(r,t,a,i,d,x){let p=0,j=0,c=null,s=null;return r>t?(c="AEK",s="Real"):r<t&&(c="Real",s="AEK"),c&&s&&(c==="AEK"?(p=1e6-t*5e4-a*2e4-i*5e4,j=-(5e5+r*5e4+d*2e4+x*5e4)):(j=1e6-r*5e4-d*2e4-x*5e4,p=-(5e5+t*5e4+a*2e4+i*5e4))),{prizeaek:p,prizereal:j,winner:c,loser:s}}static async updatePlayersGoals(r,t){for(const a of r)if(!(!a||!a.trim()))try{const i=await u.select("players","goals",{eq:{name:a,team:t}});if(i.data&&i.data.length>0){const x=(i.data[0].goals||0)+1,p=await u.select("players","id",{eq:{name:a,team:t}});p.data&&p.data.length>0&&await u.update("players",{goals:x},p.data[0].id)}}catch(i){console.warn(`Failed to update goals for player ${a}:`,i)}}static async updatePlayerOfTheMatchStats(r){try{const t=await u.select("players","team",{eq:{name:r}});if(!t.data||t.data.length===0){console.warn(`Player ${r} not found for SdS stats`);return}const a=t.data[0].team,i=await u.select("spieler_des_spiels","*",{eq:{name:r,team:a}});if(i.data&&i.data.length>0){const d=i.data[0];await u.update("spieler_des_spiels",{count:d.count+1},d.id)}else await u.insert("spieler_des_spiels",{name:r,team:a,count:1})}catch(t){console.warn(`Failed to update SdS stats for ${r}:`,t)}}static async processFinancialTransactions({matchId:r,date:t,prizeaek:a,prizereal:i,manofthematch:d,winner:x,loser:p}){const j=await this.getTeamFinance("AEK"),c=await this.getTeamFinance("Real");let s=j.balance||0,n=c.balance||0;const f=d?await this.getSdSBonus(d,"AEK"):0,h=d?await this.getSdSBonus(d,"Real"):0;f>0&&(s+=f,await this.insertTransaction({date:t,type:"Bonus SdS",team:"AEK",amount:f,match_id:r,info:"SdS Bonus"}),await this.updateTeamBalance("AEK",s)),h>0&&(n+=h,await this.insertTransaction({date:t,type:"Bonus SdS",team:"Real",amount:h,match_id:r,info:"SdS Bonus"}),await this.updateTeamBalance("Real",n)),a!==0&&(s+=a,s<0&&(s=0),await this.insertTransaction({date:t,type:"Preisgeld",team:"AEK",amount:a,match_id:r,info:"Preisgeld"}),await this.updateTeamBalance("AEK",s)),i!==0&&(n+=i,n<0&&(n=0),await this.insertTransaction({date:t,type:"Preisgeld",team:"Real",amount:i,match_id:r,info:"Preisgeld"}),await this.updateTeamBalance("Real",n)),x&&p&&await this.processEchtgeldAusgleich({date:t,matchId:r,winner:x,loser:p,aekBalance:s,realBalance:n,prizeaek:a,prizereal:i,sdsBonusAek:f>0?1:0,sdsBonusReal:h>0?1:0,manofthematch:d})}static async getTeamFinance(r){const t=await u.select("finances","*",{eq:{team:r}});return t.data&&t.data.length>0?t.data[0]:{balance:0,debt:0}}static async getSdSBonus(r,t){const a=await u.select("players","team",{eq:{name:r}});return a.data&&a.data.length>0&&a.data[0].team===t?1e5:0}static async insertTransaction(r){return await u.insert("transactions",r)}static async updateTeamBalance(r,t){const a=await u.select("finances","id",{eq:{team:r}});return a.data&&a.data.length>0?await u.update("finances",{balance:t},a.data[0].id):await u.insert("finances",{team:r,balance:t,debt:0})}static async processEchtgeldAusgleich({date:r,matchId:t,winner:a,loser:i,aekBalance:d,realBalance:x,prizeaek:p,prizereal:j,sdsBonusAek:c,sdsBonusReal:s,manofthematch:n}){const f=await this.getTeamFinance("AEK"),h=await this.getTeamFinance("Real"),v={AEK:f.debt||0,Real:h.debt||0},y=(T,q,$)=>{let R=T;$&&(R+=1e5);let K=(Math.abs(q)-R)/1e5;return K<0&&(K=0),5+Math.round(K)},w=y(d,p,c),l=y(x,j,s),o=i==="AEK"?w:l,m=v[a],b=v[i],N=Math.min(m,o*1),k=Math.max(0,m-N),E=o*1-N,B=b+Math.max(0,E),M=await u.select("finances","id",{eq:{team:a}});if(M.data&&M.data.length>0&&await u.update("finances",{debt:k},M.data[0].id),E>0){await this.insertTransaction({date:r,type:"Echtgeld-Ausgleich",team:i,amount:Math.max(0,E),match_id:t,info:"Echtgeld-Ausgleich"});const T=await u.select("finances","id",{eq:{team:i}});T.data&&T.data.length>0&&await u.update("finances",{debt:B},T.data[0].id)}N>0&&await this.insertTransaction({date:r,type:"Echtgeld-Ausgleich (getilgt)",team:a,amount:-N,match_id:t,info:"Echtgeld-Ausgleich (getilgt)"})}static async deleteMatchTransactions(r){const t=await u.select("transactions","*",{eq:{match_id:r}});if(t.data)for(const a of t.data)await u.delete("transactions",a.id);await u.delete("matches",r)}static async decrementBansAfterMatch(){try{const r=await u.select("bans","*");if(!r.data)return;for(const t of r.data)if(t.matchesserved<t.totalgames){const a=t.matchesserved+1;await u.update("bans",{matchesserved:a},t.id)}}catch(r){console.warn("Failed to decrement bans:",r)}}}function F(){const{data:g}=C("players","*"),[r,t]=S.useState(!1),[a,i]=S.useState({teama:"AEK",teamb:"Real",date:new Date().toISOString().split("T")[0],goalsa:0,goalsb:0,goalslista:[],goalslistb:[],ownGoalsA:0,ownGoalsB:0,yellowa:0,reda:0,yellowb:0,redb:0,prizeaek:0,prizereal:0,manofthematch:""}),[d,x]=S.useState(!1),p=(l,o)=>l.reduce((b,N)=>b+N.count,0)+o,j=l=>{i(o=>{const m={...o,...l};m.goalsa=p(m.goalslista,m.ownGoalsA),m.goalsb=p(m.goalslistb,m.ownGoalsB);const{prizeaek:b,prizereal:N}=G.calculatePrizeMoney(m.goalsa,m.goalsb,m.yellowa,m.reda,m.yellowb,m.redb);return m.prizeaek=b,m.prizereal=N,m})},c=(l,o)=>{j({[l]:o})},s=async l=>{l.preventDefault(),x(!0);try{const o=[],m=[];a.goalslista.forEach(N=>{for(let k=0;k<N.count;k++)o.push(N.player)}),a.goalslistb.forEach(N=>{for(let k=0;k<N.count;k++)m.push(N.player)});const b=await G.submitMatch({date:a.date,teama:a.teama.trim(),teamb:a.teamb.trim(),goalsa:a.goalsa,goalsb:a.goalsb,goalslista:o,goalslistb:m,ownGoalsA:a.ownGoalsA,ownGoalsB:a.ownGoalsB,yellowa:parseInt(a.yellowa)||0,reda:parseInt(a.reda)||0,yellowb:parseInt(a.yellowb)||0,redb:parseInt(a.redb)||0,manofthematch:a.manofthematch||null});i({teama:"AEK",teamb:"Real",date:new Date().toISOString().split("T")[0],goalsa:0,goalsb:0,goalslista:[],goalslistb:[],ownGoalsA:0,ownGoalsB:0,yellowa:0,reda:0,yellowb:0,redb:0,prizeaek:0,prizereal:0,manofthematch:""}),t(!1),A.success(b.message)}catch(o){console.error("Match submission error:",o),A.error(o.message||"Fehler beim Hinzufügen des Spiels")}finally{x(!1)}},n=a.date,f=l=>g?g.filter(o=>o.team===l):[],h=(l,o)=>{const m=l==="AEK"?"goalslista":"goalslistb";j({[m]:a[m].map(b=>b.player===o?{...b,count:b.count+1}:b).concat(a[m].find(b=>b.player===o)?[]:[{player:o,count:1}])})},v=(l,o)=>{const m=l==="AEK"?"goalslista":"goalslistb";j({[m]:a[m].map(b=>b.player===o?{...b,count:Math.max(0,b.count-1)}:b).filter(b=>b.count>0)})},y=(l,o)=>{const b=a[l==="AEK"?"goalslista":"goalslistb"].find(N=>N.player===o);return b?b.count:0},w=(l,o)=>{const m=l==="AEK"?"ownGoalsA":"ownGoalsB",b=Math.max(0,a[m]+o);j({[m]:b})};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neues Spiel hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Fügen Sie ein neues Spiel zur Datenbank hinzu."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚽"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Spiel hinzufügen"}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um ein neues Spiel zu erfassen."}),e.jsxs("button",{onClick:()=>t(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neues Spiel erfassen"]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neues Spiel"}),e.jsx("button",{onClick:()=>t(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:d,children:"×"})]}),e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-2",children:"⚽ Spielpaarung"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded-lg font-medium",children:"AEK Athen"}),e.jsx("div",{className:"text-gray-500 font-bold text-xl",children:"vs"}),e.jsx("div",{className:"bg-red-100 text-red-800 px-4 py-2 rounded-lg font-medium",children:"Real Madrid"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Datum *"}),e.jsx("input",{type:"date",value:a.date,onChange:l=>c("date",l.target.value),className:"form-input",required:!0,disabled:d})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"⚽ Live Torwertung"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-700",children:[a.goalsa," : ",a.goalsb]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["AEK Athen ",a.goalsa," - ",a.goalsb," Real Madrid"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("h5",{className:"text-sm font-medium text-blue-600 mb-3",children:"AEK Athen"})}),e.jsx("div",{className:"space-y-2",children:f("AEK").map(l=>{const o=y("AEK",l.name);return e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:l.name}),e.jsx("div",{className:"text-xs text-gray-500",children:l.position})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>v("AEK",l.name),className:"w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d||o===0,children:"−"}),e.jsx("span",{className:"w-8 text-center font-bold text-lg text-gray-700",children:o}),e.jsx("button",{type:"button",onClick:()=>h("AEK",l.name),className:"w-8 h-8 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d,children:"+"})]})]},l.id)})}),e.jsxs("div",{className:"flex items-center justify-between bg-orange-50 rounded-lg p-2 border border-orange-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Eigentore"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Zählen ins Ergebnis"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>w("AEK",-1),className:"w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d||a.ownGoalsA===0,children:"−"}),e.jsx("span",{className:"w-8 text-center font-bold text-lg text-gray-700",children:a.ownGoalsA}),e.jsx("button",{type:"button",onClick:()=>w("AEK",1),className:"w-8 h-8 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d,children:"+"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsx("h5",{className:"text-sm font-medium text-red-600 mb-3",children:"Real Madrid"})}),e.jsx("div",{className:"space-y-2",children:f("Real").map(l=>{const o=y("Real",l.name);return e.jsxs("div",{className:"flex items-center justify-between bg-red-50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:l.name}),e.jsx("div",{className:"text-xs text-gray-500",children:l.position})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>v("Real",l.name),className:"w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d||o===0,children:"−"}),e.jsx("span",{className:"w-8 text-center font-bold text-lg text-gray-700",children:o}),e.jsx("button",{type:"button",onClick:()=>h("Real",l.name),className:"w-8 h-8 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d,children:"+"})]})]},l.id)})}),e.jsxs("div",{className:"flex items-center justify-between bg-orange-50 rounded-lg p-2 border border-orange-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Eigentore"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Zählen ins Ergebnis"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>w("Real",-1),className:"w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d||a.ownGoalsB===0,children:"−"}),e.jsx("span",{className:"w-8 text-center font-bold text-lg text-gray-700",children:a.ownGoalsB}),e.jsx("button",{type:"button",onClick:()=>w("Real",1),className:"w-8 h-8 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors",disabled:d,children:"+"})]})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"🟨🟥 Karten"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Heimteam"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟨 Gelbe Karten"}),e.jsx("input",{type:"number",min:"0",value:a.yellowa,onChange:l=>c("yellowa",l.target.value),className:"form-input",disabled:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟥 Rote Karten"}),e.jsx("input",{type:"number",min:"0",value:a.reda,onChange:l=>c("reda",l.target.value),className:"form-input",disabled:d})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium",children:"Gastteam"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟨 Gelbe Karten"}),e.jsx("input",{type:"number",min:"0",value:a.yellowb,onChange:l=>c("yellowb",l.target.value),className:"form-input",disabled:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"🟥 Rote Karten"}),e.jsx("input",{type:"number",min:"0",value:a.redb,onChange:l=>c("redb",l.target.value),className:"form-input",disabled:d})]})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"💰 Preisgelder (automatisch berechnet)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Preisgeld AEK (€)"}),e.jsx("input",{type:"number",value:a.prizeaek,className:"form-input bg-gray-100",placeholder:"Automatisch berechnet",disabled:!0,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Preisgeld Real (€)"}),e.jsx("input",{type:"number",value:a.prizereal,className:"form-input bg-gray-100",placeholder:"Automatisch berechnet",disabled:!0,readOnly:!0})]})]}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Basierend auf Ergebnis und Karten: Gewinner 1M€ - (Verlierer-Tore × 50k€) - (Karten × 20k€/50k€)"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"⭐ Spieler des Spiels"}),e.jsxs("select",{value:a.manofthematch,onChange:l=>c("manofthematch",l.target.value),className:"form-input",disabled:d,children:[e.jsx("option",{value:"",children:"Keinen Spieler auswählen"}),g&&g.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.team," - ",l.position,")"]},l.id))]}),!g||g.length===0&&e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Keine Spieler verfügbar. Bitte fügen Sie erst Spieler hinzu."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>t(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:d,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!n||d,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Nach dem Hinzufügen können Sie das Spiel in der Spiele-Übersicht einsehen und bearbeiten."})]})]})})]})}const z=[{value:"Gelb-Rote Karte",label:"Gelb-Rote Karte",duration:1,fixedDuration:!0,icon:"🟨🟥"},{value:"Rote Karte",label:"Rote Karte",duration:2,fixedDuration:!1,icon:"🟥"},{value:"Verletzung",label:"Verletzung",duration:3,fixedDuration:!1,icon:"🏥"}];function O(){const{data:g}=C("players","*"),[r,t]=S.useState(!1),[a,i]=S.useState({player_id:"",type:"",reason:""}),[d,x]=S.useState(!1),p=(n,f)=>{i(h=>({...h,[n]:f}))},j=async n=>{var f;n.preventDefault(),x(!0);try{const h=g==null?void 0:g.find(o=>o.id===parseInt(a.player_id)),v=z.find(o=>o.value===a.type);if(!h)throw new Error("Spieler nicht gefunden");if(!v)throw new Error("Sperrart nicht gefunden");const w=(f=(await u.select("bans","*",{eq:{player_id:h.id}})).data)==null?void 0:f.find(o=>(o.matchesserved||0)<(o.totalgames||0));if(w)throw new Error(`Spieler "${h.name}" ist bereits gesperrt (${w.totalgames-w.matchesserved} Spiele verbleibend)`);const l=await u.insert("bans",{player_id:h.id,team:h.team,type:v.value,totalgames:v.duration,matchesserved:0,reason:a.reason||v.value,created_at:new Date().toISOString()});if(l.error)throw new Error(`Ban insert failed: ${l.error.message}`);i({player_id:"",type:"",reason:""}),t(!1),A.success(`Sperre für "${h.name}" erfolgreich hinzugefügt!`)}catch(h){console.error("Ban submission error:",h),A.error(h.message||"Fehler beim Hinzufügen der Sperre")}finally{x(!1)}},c=a.player_id&&a.type,s=z.find(n=>n.value===a.type);return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neue Sperre hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Erstellen Sie eine neue Spielersperre in der Datenbank."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🚫"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Sperre hinzufügen"}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um eine neue Spielersperre zu erfassen."}),e.jsxs("button",{onClick:()=>t(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neue Sperre erfassen"]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neue Sperre"}),e.jsx("button",{onClick:()=>t(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:d,children:"×"})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Spieler *"}),e.jsxs("select",{value:a.player_id,onChange:n=>p("player_id",n.target.value),className:"form-input",required:!0,disabled:d,children:[e.jsx("option",{value:"",children:"Spieler wählen"}),g&&g.map(n=>e.jsxs("option",{value:n.id,children:[n.name," (",n.team," - ",n.position,")"]},n.id))]}),!g||g.length===0&&e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Keine Spieler verfügbar. Bitte fügen Sie erst Spieler hinzu."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Sperrart *"}),e.jsxs("select",{value:a.type,onChange:n=>p("type",n.target.value),className:"form-input",required:!0,disabled:d,children:[e.jsx("option",{value:"",children:"Sperrart wählen"}),z.map(n=>e.jsxs("option",{value:n.value,children:[n.icon," ",n.label," (",n.duration," Spiel",n.duration!==1?"e":"",")"]},n.value))]}),s&&e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Sperre dauert ",s.duration," Spiel",s.duration!==1?"e":""]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Zusätzlicher Grund (optional)"}),e.jsx("input",{type:"text",value:a.reason,onChange:n=>p("reason",n.target.value),className:"form-input",placeholder:"Weitere Details zur Sperre...",disabled:d})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>t(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:d,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!c||d||!g||g.length===0,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Sperrarten"}),e.jsx("div",{className:"space-y-2",children:z.map(n=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-bg-secondary rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:n.icon}),e.jsx("span",{className:"font-medium text-text-primary",children:n.label})]}),e.jsxs("span",{className:"text-sm text-text-muted",children:[n.duration," Spiel",n.duration!==1?"e":""]})]},n.value))})]}),e.jsx("div",{className:"mt-6 modern-card bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-yellow-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-yellow-700 text-sm",children:"Nach dem Hinzufügen können Sie die Sperre in der Sperren-Übersicht einsehen und verwalten."})]})]})})]})}const D=[{value:"TH",label:"Torwart (TH)"},{value:"IV",label:"Innenverteidiger (IV)"},{value:"AV",label:"Außenverteidiger (AV)"},{value:"ZM",label:"Zentrales Mittelfeld (ZM)"},{value:"OM",label:"Offensives Mittelfeld (OM)"},{value:"ST",label:"Stürmer (ST)"}],P=[{value:"AEK",label:"AEK Athen",color:"blue"},{value:"Real",label:"Real Madrid",color:"red"},{value:"Ehemalige",label:"Ehemalige",color:"gray"}];function V(){const[g,r]=S.useState(!1),[t,a]=S.useState({name:"",team:"",position:"",goals:0,value:0,status:"active"}),[i,d]=S.useState(!1),x=(c,s)=>{a(n=>({...n,[c]:s}))},p=async c=>{c.preventDefault(),d(!0);try{const s=await u.select("players","*",{eq:{name:t.name.trim(),team:t.team.trim()}});if(s.data&&s.data.length>0)throw new Error(`Spieler "${t.name}" existiert bereits im Team "${t.team}"`);const n=await u.insert("players",{name:t.name.trim(),team:t.team.trim(),position:t.position.trim().toUpperCase(),goals:parseInt(t.goals)||0,value:parseFloat(t.value)||0,status:t.status||"active",created_at:new Date().toISOString()});if(n.error)throw new Error(`Player insert failed: ${n.error.message}`);a({name:"",team:"",position:"",goals:0,value:0,status:"active"}),r(!1),A.success(`Spieler "${t.name}" erfolgreich hinzugefügt!`)}catch(s){console.error("Player submission error:",s),A.error(s.message||"Fehler beim Hinzufügen des Spielers")}finally{d(!1)}},j=t.name&&t.team&&t.position&&t.value!=="";return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neuen Spieler hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Fügen Sie einen neuen Spieler zur Datenbank hinzu."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"👤"}),e.jsxs("h4",{className:"text-lg font-medium text-text-primary mb-2",children:[e.jsx("i",{className:"fas fa-user-plus mr-2"}),"Spieler hinzufügen"]}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um einen neuen Spieler zu erfassen."}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neuen Spieler erfassen"]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neuer Spieler"}),e.jsx("button",{onClick:()=>r(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:i,children:"×"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Spielername *"}),e.jsx("input",{type:"text",value:t.name,onChange:c=>x("name",c.target.value),className:"form-input",placeholder:"z.B. Max Mustermann",required:!0,disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Team *"}),e.jsxs("select",{value:t.team,onChange:c=>x("team",c.target.value),className:"form-input",required:!0,disabled:i,children:[e.jsx("option",{value:"",children:"Team wählen"}),P.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Position *"}),e.jsxs("select",{value:t.position,onChange:c=>x("position",c.target.value),className:"form-input",required:!0,disabled:i,children:[e.jsx("option",{value:"",children:"Position wählen"}),D.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Anzahl Tore"}),e.jsx("input",{type:"number",min:"0",value:t.goals,onChange:c=>x("goals",c.target.value),className:"form-input",placeholder:"0",disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Marktwert (Millionen €) *"}),e.jsx("input",{type:"number",min:"0",step:"0.1",value:t.value,onChange:c=>x("value",c.target.value),className:"form-input",placeholder:"0.0",disabled:i}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Marktwert in Millionen Euro (z.B. 1.5 für 1.5M €)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:i,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!j||i,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:i?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Teams"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:P.map(c=>e.jsxs("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:[e.jsxs("span",{className:`font-medium ${c.color==="blue"?"text-blue-600":c.color==="red"?"text-red-600":"text-gray-600"}`,children:[c.color==="blue"?"🔵":c.color==="red"?"🔴":"⚫"," ",c.label]}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["(",c.value,")"]})]},c.value))})]}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Positionen"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:D.map(c=>e.jsx("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:e.jsx("span",{className:"font-medium text-text-primary text-sm",children:c.label})},c.value))})]}),e.jsx("div",{className:"mt-6 modern-card bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-green-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-green-700 text-sm",children:"Nach dem Hinzufügen können Sie den Spieler in der Kader-Übersicht einsehen und verwalten."})]})]})})]})}const I=[{value:"Preisgeld",label:"Preisgeld",icon:"🏆"},{value:"Strafe",label:"Strafe",icon:"📉"},{value:"Spielerkauf",label:"Spielerkauf",icon:"👤"},{value:"Spielerverkauf",label:"Spielerverkauf",icon:"💰"},{value:"Echtgeld-Ausgleich",label:"Echtgeld-Ausgleich",icon:"💳"},{value:"SdS Bonus",label:"Spieler des Spiels Bonus",icon:"⭐"},{value:"Sonstiges",label:"Sonstiges",icon:"📈"}],_=[{value:"AEK",label:"AEK Athen",color:"blue"},{value:"Real",label:"Real Madrid",color:"red"}];function H(){C("finances","*");const[g,r]=S.useState(!1),[t,a]=S.useState({team:"",type:"",amount:"",info:"",date:new Date().toISOString().split("T")[0]}),[i,d]=S.useState(!1),x=(s,n)=>{a(f=>({...f,[s]:n}))},p=async s=>{s.preventDefault(),d(!0);try{const n=parseFloat(t.amount),f=await u.insert("transactions",{date:t.date,type:t.type.trim(),team:t.team.trim(),amount:n,info:t.info.trim(),match_id:null});if(f.error)throw new Error(`Transaction insert failed: ${f.error.message}`);await j(t.team.trim(),t.type.trim(),n),a({team:"",type:"",amount:"",info:"",date:new Date().toISOString().split("T")[0]}),r(!1),A.success("Transaktion erfolgreich hinzugefügt!")}catch(n){console.error("Transaction submission error:",n),A.error(n.message||"Fehler beim Hinzufügen der Transaktion")}finally{d(!1)}},j=async(s,n,f)=>{try{const h=await u.select("finances","*",{eq:{team:s}});let v=h.data&&h.data.length>0?h.data[0]:{team:s,balance:0,debt:0},y={};if(n==="Echtgeld-Ausgleich")y.debt=(v.debt||0)+f;else{let w=(v.balance||0)+f;w<0&&(w=0),y.balance=w}v.id?await u.update("finances",y,v.id):await u.insert("finances",{team:s,balance:y.balance||0,debt:y.debt||0})}catch(h){console.warn("Failed to update finances:",h)}},c=t.team&&t.type&&t.amount&&t.date;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Neue Transaktion hinzufügen"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Erfassen Sie eine neue finanzielle Transaktion."})]}),e.jsx("div",{className:"modern-card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"💰"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Transaktion hinzufügen"}),e.jsx("p",{className:"text-text-muted mb-6",children:"Klicken Sie auf den Button, um eine neue Transaktion zu erfassen."}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Neue Transaktion erfassen"]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-bg-secondary rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Neue Transaktion"}),e.jsx("button",{onClick:()=>r(!1),className:"text-text-muted hover:text-text-primary text-2xl",disabled:i,children:"×"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Team *"}),e.jsxs("select",{value:t.team,onChange:s=>x("team",s.target.value),className:"form-input",required:!0,disabled:i,children:[e.jsx("option",{value:"",children:"Team wählen"}),_.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Transaktionsart *"}),e.jsxs("select",{value:t.type,onChange:s=>x("type",s.target.value),className:"form-input",required:!0,disabled:i,children:[e.jsx("option",{value:"",children:"Typ wählen"}),I.map(s=>e.jsxs("option",{value:s.value,children:[s.icon," ",s.label]},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Betrag (€) *"}),e.jsx("input",{type:"number",step:"0.01",value:t.amount,onChange:s=>x("amount",s.target.value),className:"form-input",placeholder:"0.00",required:!0,disabled:i}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Negative Werte für Ausgaben, positive für Einnahmen"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Beschreibung"}),e.jsx("input",{type:"text",value:t.info,onChange:s=>x("info",s.target.value),className:"form-input",placeholder:"Zusätzliche Informationen...",disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Datum *"}),e.jsx("input",{type:"date",value:t.date,onChange:s=>x("date",s.target.value),className:"form-input",required:!0,disabled:i})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:bg-bg-tertiary transition-colors",disabled:i,children:"Abbrechen"}),e.jsx("button",{type:"submit",disabled:!c||i,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:i?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"spinner w-4 h-4 mr-2"}),"Speichern..."]}):"Speichern"})]})]})]})})}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Transaktionsarten"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:I.map(s=>e.jsxs("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:s.icon}),e.jsx("span",{className:"font-medium text-text-primary",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"mt-6 modern-card",children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-3",children:"Verfügbare Teams"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:_.map(s=>e.jsxs("div",{className:"p-3 bg-bg-secondary rounded-lg text-center",children:[e.jsxs("span",{className:`font-medium ${s.color==="blue"?"text-blue-600":"text-red-600"}`,children:[s.color==="blue"?"🔵":"🔴"," ",s.label]}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["(",s.value,")"]})]},s.value))})]}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Hinweis"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Nach dem Hinzufügen können Sie die Transaktion in der Finanzen-Übersicht einsehen."})]})]})})]})}function J(){const[g,r]=S.useState("matches"),t=[{id:"matches",label:"Spiele hinzufügen",icon:"fas fa-futbol"},{id:"bans",label:"Sperren hinzufügen",icon:"fas fa-ban"},{id:"players",label:"Spieler hinzufügen",icon:"fas fa-user-plus"},{id:"transactions",label:"Transaktionen hinzufügen",icon:"fas fa-euro-sign"}],a=()=>{switch(g){case"matches":return e.jsx(F,{});case"bans":return e.jsx(O,{});case"players":return e.jsx(V,{});case"transactions":return e.jsx(H,{});default:return e.jsx(F,{})}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 bg-bg-secondary border-b border-border-light",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-1",children:"Verwaltung"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Hinzufügen und verwalten von Daten"})]}),e.jsx("div",{className:"bg-bg-secondary border-b border-border-light",children:e.jsx("div",{className:"flex overflow-x-auto",children:t.map(i=>e.jsxs("button",{onClick:()=>r(i.id),className:`flex-shrink-0 px-4 py-3 text-sm font-medium transition-colors whitespace-nowrap ${g===i.id?"text-primary border-b-2 border-primary bg-bg-primary":"text-text-secondary hover:text-text-primary hover:bg-bg-hover"}`,children:[e.jsx("i",{className:`${i.icon} mr-2`}),i.label]},i.id))})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a()})]})}export{J as default};
