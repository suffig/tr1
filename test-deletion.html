<!DOCTYPE html>
<html>
<head>
    <title>Test Match Deletion</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 10px; }
        .log { background: #f5f5f5; padding: 10px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Match Deletion Test</h1>
    
    <div class="test-section">
        <h2>Available Matches</h2>
        <div id="matches-list">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>Test Deletion</h2>
        <input type="number" id="match-id-input" placeholder="Enter match ID to delete">
        <button onclick="testDeleteMatch()">Delete Match</button>
    </div>
    
    <div class="test-section">
        <h2>Console Log</h2>
        <div id="console-log" class="log"></div>
    </div>

    <script type="module">
        // Simple console logging to page
        function logToPage(message) {
            const logDiv = document.getElementById('console-log');
            logDiv.textContent += new Date().toISOString() + ': ' + message + '\n';
            console.log(message);
        }

        // Override console.log for debugging
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToPage(args.join(' '));
        };

        console.error = function(...args) {
            originalLog.apply(console, args);
            logToPage('ERROR: ' + args.join(' '));
        };

        // Import the delete function
        let deleteMatch;
        try {
            const matchesModule = await import('/matches.js');
            deleteMatch = matchesModule.deleteMatch;
            console.log('✅ Successfully imported deleteMatch function');
        } catch (error) {
            console.error('Failed to import deleteMatch:', error.message);
        }

        // Load sample data to see what we're working with
        async function loadMatches() {
            try {
                const supabaseModule = await import('/supabaseClient.js');
                const supabase = supabaseModule.supabase;
                
                const { data: matches, error } = await supabase.from('matches').select('*').limit(10);
                
                if (error) {
                    console.error('Error loading matches:', error);
                    document.getElementById('matches-list').innerHTML = 'Error loading matches: ' + error.message;
                    return;
                }
                
                console.log('Found', matches?.length || 0, 'matches');
                
                const matchesList = document.getElementById('matches-list');
                if (!matches || matches.length === 0) {
                    matchesList.innerHTML = 'No matches found';
                    return;
                }
                
                matchesList.innerHTML = matches.map(m => 
                    `<div>ID: ${m.id} (${typeof m.id}) - ${m.teama || 'AEK'} ${m.goalsa || 0} : ${m.goalsb || 0} ${m.teamb || 'Real'} - ${m.date}</div>`
                ).join('');
                
            } catch (error) {
                console.error('Error in loadMatches:', error);
                document.getElementById('matches-list').innerHTML = 'Error: ' + error.message;
            }
        }

        // Test deletion function
        window.testDeleteMatch = async function() {
            const matchId = document.getElementById('match-id-input').value;
            if (!matchId) {
                console.log('Please enter a match ID');
                return;
            }
            
            console.log(`Testing deletion of match ID: ${matchId} (type: ${typeof matchId})`);
            
            if (!deleteMatch) {
                console.error('deleteMatch function not available');
                return;
            }
            
            try {
                console.log('Calling deleteMatch...');
                await deleteMatch(matchId);
                console.log('✅ Delete operation completed');
                
                // Reload matches to see if it was actually deleted
                setTimeout(loadMatches, 1000);
                
            } catch (error) {
                console.error('Delete operation failed:', error.message);
                console.error('Full error:', error);
            }
        };

        // Load matches on page load
        loadMatches();
        
        console.log('Test page loaded');
    </script>
</body>
</html>