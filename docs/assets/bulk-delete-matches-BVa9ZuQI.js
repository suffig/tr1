import{deleteMatch as m}from"./matches-CJ62wYa-.js";import{s as i}from"./dataManager-CtWei30S.js";async function d(){console.log("üîç Finding matches with ID >= 140...");try{const{data:e,error:n}=await i.from("matches").select("id, date, teama, teamb, goalsa, goalsb, manofthematch").gte("id",140).order("id");if(n)throw console.error("Error finding matches:",n),n;if(console.log(`Found ${e.length} matches with ID >= 140:`),e.forEach(o=>{console.log(`  ID ${o.id}: ${o.date} - ${o.teama} ${o.goalsa} vs ${o.goalsb} ${o.teamb} (MoM: ${o.manofthematch||"none"})`)}),e.length>0){const o=e.map(t=>t.id),{data:l,error:a}=await i.from("transactions").select("id, match_id, type, amount, team").in("match_id",o);if(!a&&l){console.log(`Found ${l.length} related transactions for these matches`);const t={};l.forEach(c=>{t[c.match_id]||(t[c.match_id]=[]),t[c.match_id].push(c)}),Object.entries(t).forEach(([c,s])=>{console.log(`    Match ${c}: ${s.length} transactions (${s.map(r=>`${r.type}: ${r.amount} (${r.team})`).join(", ")})`)})}}return e}catch(e){throw console.error(`‚ùå Error finding matches >= 140: ${e.message}`),e}}async function g(){console.log("üî• BULK DELETE: Starting deletion of all matches with ID >= 140..."),console.log("================================================================================");try{const e=await d();if(e.length===0)return console.log("‚úÖ No matches found with ID >= 140. Nothing to delete."),{deleted:0,failed:0};console.log(`
‚ö†Ô∏è WARNING: About to delete ${e.length} matches and ALL related data!`),console.log("This includes:"),console.log("- Match records"),console.log("- All related transactions (Preisgeld, Bonus SdS, Echtgeld-Ausgleich, etc.)"),console.log("- Reversal of financial changes to team balances"),console.log("- Player goal adjustments"),console.log("- Spieler des Spiels (SdS) count adjustments"),console.log("");let n=0,o=0;const l=[];for(let a=0;a<e.length;a++){const t=e[a];console.log(`
[${a+1}/${e.length}] Deleting match ${t.id}: ${t.date} - ${t.teama} vs ${t.teamb}`);try{await m(t.id),n++,console.log(`‚úÖ Successfully deleted match ${t.id}`)}catch(c){o++;const s=`Failed to delete match ${t.id}: ${c.message}`;console.error(`‚ùå ${s}`),l.push(s)}}return console.log(`
================================================================================`),console.log("üìã BULK DELETE SUMMARY:"),console.log(`‚úÖ Successfully deleted: ${n} matches`),o>0&&(console.log(`‚ùå Failed to delete: ${o} matches`),console.log(`
Errors encountered:`),l.forEach(a=>console.log(`  - ${a}`))),console.log("================================================================================"),{deleted:n,failed:o,errors:l}}catch(e){throw console.error(`‚ùå Fatal error in bulk delete: ${e.message}`),e}}async function h(){var e;console.log("üóÇÔ∏è Match Bulk Deletion Tool (ID >= 140)"),console.log(`=========================================
`);try{console.log("üì° Testing database connection...");const{data:n,error:o}=await i.from("matches").select("count",{count:"exact"});if(o)throw o;console.log(`‚úÖ Connected to database. Found ${((e=n==null?void 0:n[0])==null?void 0:e.count)||0} total matches.
`);const l=await d();if(l.length===0){console.log(`
‚úÖ No matches found with ID >= 140. Script completed successfully.`);return}if(console.log(`
‚ö†Ô∏è IMPORTANT WARNINGS:`),console.log("1. This operation is IRREVERSIBLE!"),console.log("2. Make sure you have a database backup!"),console.log("3. All related data (transactions, financial changes, player stats) will be affected!"),console.log("4. This will comprehensively clean up ALL associated data for each match."),typeof window<"u"){if(!confirm(`‚ö†Ô∏è DELETE ${l.length} matches with ID >= 140?

This will also delete all related transactions, reverse financial changes, and adjust player statistics.

This action cannot be undone!

Click OK to continue, Cancel to abort.`)){console.log("Operation cancelled by user.");return}if(!confirm(`FINAL CONFIRMATION:

You are about to permanently delete ${l.length} matches and all their related data.

Type OK to proceed or Cancel to abort.`)){console.log("Operation cancelled by user.");return}}else console.log(`
üö® PROCEEDING WITH BULK DELETE (Script execution mode)`),console.log("If you want to cancel, stop the script now with Ctrl+C"),await new Promise(t=>setTimeout(t,5e3));const a=await g();console.log(`
üèÅ Script completed. Deleted ${a.deleted} matches successfully.`),a.failed>0&&console.log(`‚ö†Ô∏è ${a.failed} matches failed to delete. Check logs above for details.`)}catch(n){console.error(`üí• Script failed: ${n.message}`),console.error("Stack trace:",n.stack)}}typeof window<"u"?(window.findMatchesAbove140=d,window.bulkDeleteMatches=g,window.bulkDeleteMain=h):import.meta.url===`file://${process.argv[1]}`&&h().catch(console.error);export{g as bulkDeleteMatches,d as findMatchesAbove140,h as main};
