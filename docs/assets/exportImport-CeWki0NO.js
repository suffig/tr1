import{d as g,s as o}from"./dataManager-B859Fmxm.js";class S{constructor(){this.loadingStates=new Set,this.loadingIndicators=new Map}show(e,t=null,n="Lädt..."){if(this.loadingStates.add(e),t){const i=this.createLoadingIndicator(n);this.loadingIndicators.set(e,{element:t,indicator:i,originalContent:t.innerHTML}),t.innerHTML="",t.appendChild(i)}this.updateGlobalLoadingState()}hide(e){if(this.loadingStates.delete(e),this.loadingIndicators.has(e)){const{element:t,originalContent:n}=this.loadingIndicators.get(e);t.innerHTML=n,this.loadingIndicators.delete(e)}this.updateGlobalLoadingState()}createLoadingIndicator(e){const t=document.createElement("div");return t.className="flex items-center justify-center py-4",t.innerHTML=`
            <div class="flex items-center space-x-2">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                <span class="text-sm text-gray-600">${e}</span>
            </div>
        `,t}updateGlobalLoadingState(){const e=this.loadingStates.size>0;document.body.classList.toggle("loading",e)}isLoading(e=null){return e?this.loadingStates.has(e):this.loadingStates.size>0}}class m{static showUserError(e,t="error"){console.error("User Error:",e);let n=document.getElementById("error-notification");n||(n=document.createElement("div"),n.id="error-notification",n.className="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-full mx-4",document.body.appendChild(n));const i={error:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-blue-500 text-white",success:"bg-green-500 text-white"};n.innerHTML=`
            <div class="rounded-lg p-4 shadow-lg ${i[t]||i.error}">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-${t==="error"?"exclamation-triangle":t==="success"?"check-circle":"info-circle"} mr-2"></i>
                        <span>${e}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        `,setTimeout(()=>{n&&n.parentElement&&n.remove()},t==="success"?3e3:5e3)}static showSuccessMessage(e){this.showUserError(e,"success")}static handleDatabaseError(e,t="Database operation"){console.error(`${t} failed:`,e);let n="Ein unerwarteter Fehler ist aufgetreten.",i="error";if(e.message){const s=e.message.toLowerCase();e.message.includes("nicht verfügbar")?(n=e.message,i="warning"):s.includes("auth")||s.includes("unauthorized")||s.includes("forbidden")?n="Authentifizierungsfehler. Bitte melden Sie sich erneut an.":s.includes("network")||s.includes("fetch")||s.includes("timeout")?n="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.":s.includes("constraint")||s.includes("duplicate")||s.includes("unique")?n="Diese Daten existieren bereits oder verletzen Datenbankregeln.":s.includes("validierung")||e.message.includes("Validierungsfehler")?(n=e.message,i="warning"):s.includes("cdn")||s.includes("blocked")?(n="CDN blockiert - Anwendung läuft im Demo-Modus.",i="info"):s.includes("session")||s.includes("token")?n="Session abgelaufen. Bitte melden Sie sich erneut an.":s.includes("permission")||s.includes("denied")?n="Keine Berechtigung für diese Aktion.":s.includes("not found")||s.includes("404")?(n="Die angeforderten Daten wurden nicht gefunden.",i="warning"):s.includes("server")||s.includes("500")||s.includes("503")?n="Server temporär nicht verfügbar. Bitte versuchen Sie es später erneut.":s.includes("offline")&&(n="Keine Internetverbindung. Funktionen sind eingeschränkt.",i="warning")}if(typeof window<"u"&&window.connectionMonitor){const s=window.connectionMonitor.getStatus();s.connected||(s.connectionType==="fallback"?(n+=" (Demo-Modus aktiv)",i="info"):s.connectionType==="offline"&&(n+=" (Offline)"))}return this.showUserError(n,i),n}static async withErrorHandling(e,t="Operation fehlgeschlagen"){try{return await e()}catch(n){throw this.handleDatabaseError(n,t),n}}}const l=new S;class p{static async exportAllData(){try{l.show("Exportiere Daten...");const e=await g.loadAllAppData(),t={version:"1.0",exportDate:new Date().toISOString(),appVersion:"FIFA-Tracker-v1.0",data:e,totalRecords:this.calculateTotalRecords(e)},n=JSON.stringify(t,null,2),i=new Blob([n],{type:"application/json"}),s=document.createElement("a");return s.href=URL.createObjectURL(i),s.download=`fifa-tracker-backup-${new Date().toISOString().split("T")[0]}.json`,s.click(),l.hide(),{success:!0,message:"Daten erfolgreich exportiert!"}}catch(e){return l.hide(),m.handle(e,"Fehler beim Exportieren der Daten"),{success:!1,error:e.message}}}static async importData(e){try{l.show("Importiere Daten...");const t=await this.readFileAsText(e),n=JSON.parse(t);if(!this.validateImportData(n))throw new Error("Ungültiges Backup-Format");const i=`Backup vom ${new Date(n.exportDate).toLocaleDateString("de-DE")} importieren?

Enthält ${n.totalRecords} Datensätze.
WARNUNG: Aktuelle Daten werden überschrieben!`;return confirm(i)?(await this.importToDatabase(n.data),l.hide(),window.renderCurrentTab&&await window.renderCurrentTab(),{success:!0,message:`${n.totalRecords} Datensätze erfolgreich importiert!`,importDate:n.exportDate}):(l.hide(),{success:!1,cancelled:!0})}catch(t){return l.hide(),m.handle(t,"Fehler beim Importieren der Daten"),{success:!1,error:t.message}}}static async exportPlayerStats(){try{l.show("Exportiere Spieler-Statistiken...");const e=await g.getAllPlayers(),t=await g.getAllMatches(),n=e.map(r=>{const d=t.filter(c=>{var u,f;return((u=c.aek_players)==null?void 0:u.includes(r.id))||((f=c.real_players)==null?void 0:f.includes(r.id))}),w=d.reduce((c,u)=>{const f=r.team==="AEK"?u.aek_goals||[]:u.real_goals||[];return c+f.filter(D=>D.player_id===r.id).length},0),b=d.filter(c=>r.team==="AEK"?(c.aek_score||0)>(c.real_score||0):(c.real_score||0)>(c.aek_score||0)).length;return{name:r.name,team:r.team,position:r.position,matches:d.length,goals:w,wins:b,winRate:d.length>0?(b/d.length*100).toFixed(1)+"%":"0%",goalsPerGame:d.length>0?(w/d.length).toFixed(2):"0.00"}}),i=`Name,Team,Position,Spiele,Tore,Siege,Siegrate,Tore pro Spiel
`,s=n.map(r=>`"${r.name}","${r.team}","${r.position}",${r.matches},${r.goals},${r.wins},"${r.winRate}","${r.goalsPerGame}"`).join(`
`),x=i+s,v=new Blob([x],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a");return h.href=URL.createObjectURL(v),h.download=`spieler-statistiken-${new Date().toISOString().split("T")[0]}.csv`,h.click(),l.hide(),{success:!0,message:"Spieler-Statistiken erfolgreich exportiert!"}}catch(e){return l.hide(),m.handle(e,"Fehler beim Exportieren der Spieler-Statistiken"),{success:!1,error:e.message}}}static readFileAsText(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=s=>t(s.target.result),i.onerror=s=>n(s),i.readAsText(e)})}static validateImportData(e){return e&&e.version&&e.exportDate&&e.data&&typeof e.data=="object"}static calculateTotalRecords(e){let t=0;return e.players&&(t+=e.players.length),e.matches&&(t+=e.matches.length),e.bans&&(t+=e.bans.length),e.transactions&&(t+=e.transactions.length),e.finances&&(t+=e.finances.length),t}static async importToDatabase(e){const{user:t}=await o.auth.getUser();if(!t.user)throw new Error("Nicht angemeldet");e.players&&(await o.from("players").delete().neq("id","never-match"),e.players.length>0&&await o.from("players").insert(e.players)),e.matches&&(await o.from("matches").delete().neq("id","never-match"),e.matches.length>0&&await o.from("matches").insert(e.matches)),e.bans&&(await o.from("bans").delete().neq("id","never-match"),e.bans.length>0&&await o.from("bans").insert(e.bans)),e.transactions&&(await o.from("transactions").delete().neq("id","never-match"),e.transactions.length>0&&await o.from("transactions").insert(e.transactions)),e.finances&&(await o.from("finances").delete().neq("id","never-match"),e.finances.length>0&&await o.from("finances").insert(e.finances))}}window.exportAllData=async function(){const a=await p.exportAllData();a.success?alert("✅ "+a.message):alert("❌ Export fehlgeschlagen: "+a.error)};window.exportPlayerStats=async function(){const a=await p.exportPlayerStats();a.success?alert("✅ "+a.message):alert("❌ Export fehlgeschlagen: "+a.error)};window.handleImportFile=async function(a){const e=a.files[0];if(!e)return;const t=await p.importData(e);t.success?alert("✅ "+t.message):t.cancelled||alert("❌ Import fehlgeschlagen: "+t.error),a.value=""};export{p as DataExportImport};
