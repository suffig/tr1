import{r as j,j as e,L as U,z as f}from"./index-BydI2Bdd.js";import{u}from"./useSupabase-BIjAjS2_.js";import{E as _}from"./ExportImportManager-D1-VgWmz.js";function J(){const[m,M]=j.useState("AEK"),[N,K]=j.useState(new Set),[$,v]=j.useState(!1),{data:y,loading:z}=u("finances","*"),{data:c,loading:D}=u("transactions","*",{order:{column:"id",ascending:!1}}),{data:w,loading:F}=u("matches","*",{order:{column:"id",ascending:!1}}),{data:k,loading:L}=u("players","*"),B=z||D||F||L,x=s=>y?y.find(t=>t.team===s)||{balance:0,debt:0}:{balance:0,debt:0},i=s=>k?k.filter(t=>t.team===s).reduce((t,n)=>t+(n.value||0),0):0,R=()=>{const s=x("AEK").balance||0,t=x("Real").balance||0,n=i("AEK"),o=i("Real"),a=n*1e6,d=o*1e6;return Math.round(s+t+a+d)},C=s=>c?c.filter(t=>t.team===s):[],l=s=>{const t=Math.round(s||0);return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)},E=s=>`${(s||0).toFixed(1)}M €`,S=s=>{switch(s){case"Preisgeld":return"🏆";case"Sonstiges":return"📈";case"Strafe":return"📉";case"Spielerkauf":return"👤";case"Spielerverkauf":return"💰";case"SdS Bonus":return"⭐";case"Echtgeld-Ausgleich":return"💳";case"Echtgeld-Ausgleich (getilgt)":return"✅";default:return"💰"}},q=s=>{const t=[{container:"border-blue-400 bg-blue-50 dark:bg-blue-700",header:"text-blue-800 dark:text-blue-100",accent:"blue-500"},{container:"border-green-600 bg-green-100 dark:bg-green-600",header:"text-green-800 dark:text-green-300",accent:"green-600"},{container:"border-red-500 bg-red-50 dark:bg-red-500",header:"text-red-800 dark:text-red-100",accent:"red-500"},{container:"border-purple-500 bg-purple-100 dark:bg-purple-500",header:"text-purple-700 dark:text-purple-100",accent:"purple-500"},{container:"border-yellow-400 bg-yellow-100 dark:bg-yellow-900",header:"text-yellow-800 dark:text-yellow-300",accent:"yellow-400"}],n=(s-1)%t.length;return t[n]},V=s=>{const t=new Set(N);t.has(s)?t.delete(s):t.add(s),K(t)},G=()=>{if(!c||!w)return{matchGroups:[],nonMatchTransactions:[]};const s=[...w].sort((a,d)=>new Date(d.date)-new Date(a.date)),t=[],n=[],o=new Set(s.map(a=>a.id));for(const a of s){const d=c.filter(r=>r.match_id===a.id);d.length&&t.push({match:a,transactions:d})}return c.forEach(a=>{(!a.match_id||!o.has(a.match_id))&&n.push(a)}),{matchGroups:t,nonMatchTransactions:n}};if(B)return e.jsx(U,{message:"Lade Finanzen..."});const b=x("AEK"),p=x("Real"),T=R(),I=x(m),A=C(m),{matchGroups:g,nonMatchTransactions:h}=G();return e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Finanzen"}),e.jsx("p",{className:"text-text-muted",children:"Team-Budgets und Transaktionsübersicht"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"modern-card text-center border-l-4 border-blue-400",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-2",children:"🔵"}),e.jsx("h3",{className:"font-semibold text-blue-600",children:"AEK Athen"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Kontostand: ",e.jsx("span",{className:"font-bold text-blue-600",children:l(b.balance)})]}),e.jsxs("div",{children:["Kaderwert: ",e.jsx("span",{className:"font-bold text-blue-600",children:E(i("AEK"))})]}),e.jsxs("div",{children:["Schulden: ",e.jsx("span",{className:"font-bold text-blue-600",children:l(b.debt||0)})]})]})]}),e.jsxs("div",{className:"modern-card text-center border-l-4 border-red-400",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-2",children:"🔴"}),e.jsx("h3",{className:"font-semibold text-red-600",children:"Real Madrid"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Kontostand: ",e.jsx("span",{className:"font-bold text-red-600",children:l(p.balance)})]}),e.jsxs("div",{children:["Kaderwert: ",e.jsx("span",{className:"font-bold text-red-600",children:E(i("Real"))})]}),e.jsxs("div",{children:["Schulden: ",e.jsx("span",{className:"font-bold text-red-600",children:l(p.debt||0)})]})]})]}),e.jsxs("div",{className:"modern-card text-center border-l-4 border-primary-green",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-2",children:"💰"}),e.jsx("h3",{className:"font-semibold text-primary-green",children:"Gesamt"})]}),e.jsx("div",{className:"text-2xl font-bold text-text-primary",children:l(T)}),e.jsx("div",{className:"text-sm text-text-muted",children:"Gesamtkapital (Bargeld + Kaderwerte)"})]})]}),e.jsxs("div",{className:"modern-card mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"💼"}),"Finanz-Management"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center justify-center space-x-2 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx("span",{children:"📥"}),e.jsx("span",{children:"Export/Import"})]}),e.jsxs("button",{onClick:()=>{const s=b.balance+p.balance,t=(i("AEK")+i("Real"))*1e6,n=s>0?s/T*100:0;f.success(`💰 Finanz-Analyse:

Bargeld: ${l(s)}
Kaderwerte: ${l(t)}
Liquidität: ${n.toFixed(1)}%`,{duration:5e3})},className:"flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx("span",{children:"📊"}),e.jsx("span",{children:"Finanz-Analyse"})]}),e.jsxs("button",{onClick:()=>{const s=(c==null?void 0:c.slice(0,5))||[];if(s.length===0){f.error("Keine Transaktionen vorhanden");return}const t=s.map(n=>`${n.type}: ${l(n.amount)} (${n.team||"Unbekannt"})`).join(`
`);f.success(`📋 Letzte Transaktionen:

${t}`,{duration:6e3})},className:"flex items-center justify-center space-x-2 bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:[e.jsx("span",{children:"📋"}),e.jsx("span",{children:"Letzte Aktivitäten"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Match-Transaktionen"}),g.length>0?e.jsx("div",{className:"space-y-3",children:g.map(({match:s,transactions:t},n)=>{const o=g.length-n,a=q(o),d=!N.has(s.id);return e.jsxs("div",{className:`border-2 ${a.container} rounded-lg shadow-lg`,children:[e.jsxs("button",{onClick:()=>V(s.id),className:"w-full p-3 flex items-center justify-between cursor-pointer hover:bg-opacity-80 transition-all duration-200 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 bg-${a.accent} rounded-full mr-2 flex-shrink-0`}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:`text-lg font-extrabold ${a.header}`,children:["AEK ",s.goalsa||0,":",s.goalsb||0," Real"]}),e.jsx("div",{className:`text-xs font-normal opacity-90 ${a.header}`,children:new Date(s.date).toLocaleDateString("de-DE")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`text-xs bg-${a.accent} text-white px-2 py-1 rounded-full font-semibold`,children:[t.length," Transaktion",t.length!==1?"en":""]}),e.jsx("span",{className:`text-lg font-bold ${a.header} transition-transform duration-200 ${d?"rotate-90":""}`,children:"▶"})]})]}),!d&&e.jsx("div",{className:"p-3 pt-0",children:e.jsx("div",{className:"space-y-2",children:t.map(r=>e.jsx("div",{className:"bg-white bg-opacity-50 rounded-lg p-3 border border-white border-opacity-30",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-xl",children:S(r.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h5",{className:"font-medium text-text-primary",children:r.info||"Transaktion"}),e.jsx("span",{className:`text-sm font-medium ${r.amount>0?"text-primary-green":"text-accent-red"}`,children:r.type})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-text-muted",children:[e.jsxs("span",{className:r.team==="AEK"?"text-blue-600":"text-red-600",children:[r.team==="AEK"?"🔵":"🔴"," ",r.team]}),r.date&&e.jsx("span",{children:new Date(r.date).toLocaleDateString("de-DE")})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-lg font-bold ${r.amount>=0?"text-primary-green":"text-accent-red"}`,children:[r.amount<0?"-":"+",l(Math.abs(r.amount||0))]})})]})},r.id))})})]},s.id)})}):e.jsxs("div",{className:"modern-card text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚽"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Keine Match-Transaktionen"}),e.jsx("p",{className:"text-text-muted",children:"Es wurden noch keine match-bezogenen Transaktionen erfasst."})]})]}),h.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Sonstige Transaktionen"}),e.jsxs("div",{className:"border-2 border-slate-500 bg-slate-100 rounded-lg shadow-lg",children:[e.jsx("div",{className:"p-3 border-b border-slate-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-slate-400 rounded-full mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-extrabold text-slate-700",children:"Sonstige Transaktionen"}),e.jsx("div",{className:"text-xs font-normal opacity-90 text-slate-600",children:"Nicht match-bezogene Buchungen"})]})]}),e.jsxs("div",{className:"text-xs bg-slate-400 text-slate-900 px-2 py-1 rounded-full font-semibold",children:[h.length," Buchung",h.length!==1?"en":""]})]})}),e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"space-y-2",children:h.map(s=>e.jsx("div",{className:"bg-white rounded-lg p-3 border border-slate-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-xl",children:S(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h5",{className:"font-medium text-text-primary",children:s.info||"Transaktion"}),e.jsx("span",{className:`text-sm font-medium ${s.amount>0?"text-primary-green":"text-accent-red"}`,children:s.type})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-text-muted",children:[e.jsxs("span",{className:s.team==="AEK"?"text-blue-600":"text-red-600",children:[s.team==="AEK"?"🔵":"🔴"," ",s.team]}),s.date&&e.jsx("span",{children:new Date(s.date).toLocaleDateString("de-DE")})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-lg font-bold ${s.amount>=0?"text-primary-green":"text-accent-red"}`,children:[s.amount<0?"-":"+",l(Math.abs(s.amount||0))]})})]})},s.id))})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:"Team-spezifische Ansicht"}),e.jsx("div",{className:"flex gap-2 mb-4",children:["AEK","Real"].map(s=>e.jsx("button",{onClick:()=>M(s),className:`px-4 py-2 rounded-lg font-medium transition-all ${m===s?s==="AEK"?"bg-blue-600 text-white":"bg-red-600 text-white":"bg-bg-secondary text-text-muted hover:bg-bg-tertiary border border-border-light"}`,children:s==="AEK"?"🔵 AEK Athen":"🔴 Real Madrid"},s))})]}),e.jsxs("div",{className:"modern-card mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-text-primary",children:[m==="AEK"?"🔵 AEK Athen":"🔴 Real Madrid"," - Details"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-text-primary",children:l(I.balance)}),e.jsx("div",{className:"text-sm text-text-muted",children:"Aktueller Kontostand"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-primary-green/10 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-primary-green",children:A.filter(s=>s.amount>0).length}),e.jsx("div",{className:"text-sm text-text-muted",children:"Einnahmen"})]}),e.jsxs("div",{className:"text-center p-3 bg-accent-red/10 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-accent-red",children:A.filter(s=>s.amount<0).length}),e.jsx("div",{className:"text-sm text-text-muted",children:"Ausgaben"})]})]})]}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Hinweis zu Marktwerten"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Spieler-Marktwerte werden in der Datenbank in Millionen Euro gespeichert (z.B. 12.5 = 12,5M €). Für die Gesamtkapital-Berechnung werden diese automatisch in Euro umgerechnet."})]})]})}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Transaktionen verwalten"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Um neue Transaktionen hinzuzufügen, nutzen Sie den Verwaltungsbereich."})]})]})}),$&&e.jsx(_,{onClose:()=>v(!1)})]})}export{J as default};
