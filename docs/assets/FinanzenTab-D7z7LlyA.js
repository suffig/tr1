import{r as R,u as E,j as e,L as J,z as _}from"./index-CkuXuksq.js";import{E as Q}from"./ExportImportManager-DWXKdO0N.js";import{E as Y}from"./EnhancedSearch-DI5j1sCp.js";function Z(){const[s,n]=R.useState("all"),[a,x]=R.useState("both"),{data:i,loading:m}=E("finances","*"),{data:u,loading:c}=E("transactions","*",{order:{column:"date",ascending:!1}}),{data:r,loading:j}=E("matches","*"),{data:M,loading:T}=E("players","*"),w=m||c||j||T,o=R.useMemo(()=>{if(!i||!u||!r||!M)return null;const F=new Date,y=u.filter(S=>{if(s!=="all"){const z=new Date(S.date),K=Math.floor((F-z)/(1e3*60*60*24));switch(s){case"30d":if(K>30)return!1;break;case"90d":if(K>90)return!1;break;case"1y":if(K>365)return!1;break}}return!(a!=="both"&&S.team!==a)});return{profitLoss:ae(y),roi:re(y,M),trends:le(y),forecasting:ie(y),efficiency:ce(y,r),risks:de(i,M)}},[i,u,r,M,s,a]);return w?e.jsx(J,{message:"Lade Finanzanalysen..."}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"💰 Finanzanalyse"}),e.jsx("p",{className:"text-text-secondary",children:"Detaillierte Gewinn-/Verlustanalyse und Prognosen"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s,onChange:F=>n(F.target.value),className:"px-3 py-2 border border-border-light rounded-lg bg-bg-primary text-text-primary",children:[e.jsx("option",{value:"all",children:"Alle Zeiten"}),e.jsx("option",{value:"30d",children:"Letzte 30 Tage"}),e.jsx("option",{value:"90d",children:"Letzte 90 Tage"}),e.jsx("option",{value:"1y",children:"Letztes Jahr"})]}),e.jsxs("select",{value:a,onChange:F=>x(F.target.value),className:"px-3 py-2 border border-border-light rounded-lg bg-bg-primary text-text-primary",children:[e.jsx("option",{value:"both",children:"Beide Teams"}),e.jsx("option",{value:"AEK",children:"AEK Athen"}),e.jsx("option",{value:"Real",children:"Real Madrid"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"modern-card text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-green",children:N(o.profitLoss.totalProfit)}),e.jsx("div",{className:"text-sm text-text-muted",children:"Gesamtgewinn"}),e.jsxs("div",{className:`text-xs mt-1 ${o.profitLoss.trend>=0?"text-green-600":"text-red-600"}`,children:[o.profitLoss.trend>=0?"↗️":"↘️"," ",Math.abs(o.profitLoss.trend).toFixed(1),"%"]})]}),e.jsxs("div",{className:"modern-card text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary-blue",children:[o.roi.average.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-text-muted",children:"⌀ ROI"}),e.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Return on Investment"})]}),e.jsxs("div",{className:"modern-card text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-accent-orange",children:N(o.efficiency.costPerGoal)}),e.jsx("div",{className:"text-sm text-text-muted",children:"Kosten/Tor"}),e.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Effizienz-Metrik"})]}),e.jsxs("div",{className:"modern-card text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-accent-red",children:[o.risks.riskScore,"/10"]}),e.jsx("div",{className:"text-sm text-text-muted",children:"Risiko-Score"}),e.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Finanzielle Stabilität"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(X,{data:o.profitLoss}),e.jsx(ee,{data:o.roi,selectedTeam:a})]}),e.jsx(se,{data:o.trends}),e.jsx(te,{data:o.forecasting}),a==="both"&&e.jsx(ne,{data:o})]}):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Nicht genügend Daten für Finanzanalysen verfügbar."})}function X({data:s}){return e.jsxs("div",{className:"modern-card",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📊"})," Gewinn-/Verlustanalyse"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:N(s.totalIncome)}),e.jsx("div",{className:"text-sm text-green-700",children:"Gesamteinnahmen"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-red-600",children:N(s.totalExpenses)}),e.jsx("div",{className:"text-sm text-red-700",children:"Gesamtausgaben"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Preisgeld:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",N(s.prizeMoneyTotal)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Strafen:"}),e.jsxs("span",{className:"font-semibold text-red-600",children:["-",N(s.penaltiesTotal)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Spielertransfers:"}),e.jsxs("span",{className:`font-semibold ${s.transferBalance>=0?"text-green-600":"text-red-600"}`,children:[s.transferBalance>=0?"+":"",N(s.transferBalance)]})]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Netto-Ergebnis:"}),e.jsxs("span",{className:s.totalProfit>=0?"text-green-600":"text-red-600",children:[s.totalProfit>=0?"+":"",N(s.totalProfit)]})]})})]})]})}function ee({data:s,selectedTeam:n}){const a=n==="both"?s.combined:s[n.toLowerCase()];return e.jsxs("div",{className:"modern-card",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📈"})," ROI-Analyse"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-primary-blue",children:[(a==null?void 0:a.roi)||s.average,"%"]}),e.jsx("div",{className:"text-sm text-text-muted",children:"Return on Investment"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beste Investition:"}),e.jsx("span",{className:"font-semibold text-green-600",children:s.bestInvestment.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ROI:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",s.bestInvestment.roi,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Schlechteste:"}),e.jsx("span",{className:"font-semibold text-red-600",children:s.worstInvestment.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ROI:"}),e.jsxs("span",{className:"font-semibold text-red-600",children:[s.worstInvestment.roi,"%"]})]})]}),e.jsxs("div",{className:"bg-bg-secondary p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-text-primary",children:"💡 Empfehlung"}),e.jsx("div",{className:"text-sm text-text-secondary mt-1",children:s.recommendation})]})]})]})}function se({data:s}){return e.jsxs("div",{className:"modern-card",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📊"})," Finanzielle Trends"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-primary-green",children:[s.monthlyGrowth>=0?"+":"",s.monthlyGrowth.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-text-muted",children:"Monatliches Wachstum"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-primary-blue",children:N(s.avgMonthlyIncome)}),e.jsx("div",{className:"text-sm text-text-muted",children:"⌀ Monatseinkommen"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-accent-orange",children:[s.volatility.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-text-muted",children:"Volatilität"})]})]})]})}function te({data:s}){return e.jsxs("div",{className:"modern-card",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"🔮"})," Finanzprognose"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-3",children:"Nächster Monat"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Erwartete Einnahmen:"}),e.jsx("span",{className:"font-semibold text-green-600",children:N(s.nextMonth.expectedIncome)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Erwartete Ausgaben:"}),e.jsx("span",{className:"font-semibold text-red-600",children:N(s.nextMonth.expectedExpenses)})]}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Netto-Prognose:"}),e.jsxs("span",{className:s.nextMonth.netForecast>=0?"text-green-600":"text-red-600",children:[s.nextMonth.netForecast>=0?"+":"",N(s.nextMonth.netForecast)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-3",children:"Langfristig (3 Monate)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Prognostiziertes Wachstum:"}),e.jsxs("span",{className:"font-semibold text-primary-blue",children:[s.quarterlyForecast.growth>=0?"+":"",s.quarterlyForecast.growth.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Konfidenz:"}),e.jsxs("span",{className:"font-semibold",children:[s.quarterlyForecast.confidence,"%"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-bg-secondary rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium",children:"⚠️ Risikofaktoren:"}),e.jsx("ul",{className:"text-sm text-text-secondary mt-1 space-y-1",children:s.riskFactors.map((n,a)=>e.jsxs("li",{children:["• ",n]},a))})]})]})]})]})}function ne({data:s}){var n,a;return e.jsxs("div",{className:"modern-card",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"⚖️"})," Team-Vergleich"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border-light",children:[e.jsx("th",{className:"text-left py-2",children:"Metrik"}),e.jsx("th",{className:"text-center py-2",children:"🔵 AEK"}),e.jsx("th",{className:"text-center py-2",children:"🔴 Real"}),e.jsx("th",{className:"text-center py-2",children:"Sieger"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-border-light/50",children:[e.jsx("td",{className:"py-2",children:"Gesamtgewinn"}),e.jsx("td",{className:"text-center py-2",children:N(s.profitLoss.aekProfit)}),e.jsx("td",{className:"text-center py-2",children:N(s.profitLoss.realProfit)}),e.jsx("td",{className:"text-center py-2",children:s.profitLoss.aekProfit>s.profitLoss.realProfit?"🔵":"🔴"})]}),e.jsxs("tr",{className:"border-b border-border-light/50",children:[e.jsx("td",{className:"py-2",children:"ROI"}),e.jsxs("td",{className:"text-center py-2",children:[(n=s.roi.aek)==null?void 0:n.toFixed(1),"%"]}),e.jsxs("td",{className:"text-center py-2",children:[(a=s.roi.real)==null?void 0:a.toFixed(1),"%"]}),e.jsx("td",{className:"text-center py-2",children:(s.roi.aek||0)>(s.roi.real||0)?"🔵":"🔴"})]}),e.jsxs("tr",{className:"border-b border-border-light/50",children:[e.jsx("td",{className:"py-2",children:"Effizienz (€/Tor)"}),e.jsx("td",{className:"text-center py-2",children:N(s.efficiency.aekCostPerGoal)}),e.jsx("td",{className:"text-center py-2",children:N(s.efficiency.realCostPerGoal)}),e.jsx("td",{className:"text-center py-2",children:s.efficiency.aekCostPerGoal<s.efficiency.realCostPerGoal?"🔵":"🔴"})]})]})]})})]})}function N(s){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0)}function ae(s){const n=s.filter(c=>["Preisgeld","SdS Bonus","Sonstiges","Spielerverkauf"].includes(c.type)).reduce((c,r)=>c+Math.abs(r.amount||0),0),a=s.filter(c=>["Strafe","Spielerkauf"].includes(c.type)).reduce((c,r)=>c+Math.abs(r.amount||0),0),x=s.filter(c=>c.type==="Preisgeld").reduce((c,r)=>c+Math.abs(r.amount||0),0),i=s.filter(c=>c.type==="Strafe").reduce((c,r)=>c+Math.abs(r.amount||0),0),m=s.filter(c=>["Spielerkauf","Spielerverkauf"].includes(c.type)).reduce((c,r)=>c+(r.type==="Spielerverkauf"?Math.abs(r.amount||0):-Math.abs(r.amount||0)),0),u=n-a;return{totalIncome:n,totalExpenses:a,totalProfit:u,prizeMoneyTotal:x,penaltiesTotal:i,transferBalance:m,trend:u>0?15:-10,aekProfit:u*.6,realProfit:u*.4}}function re(s,n){const a=s.filter(m=>m.type==="Spielerkauf"),x=s.filter(m=>m.type==="Spielerverkauf"),i=a.length>0?(x.reduce((m,u)=>m+(u.amount||0),0)/a.reduce((m,u)=>m+Math.abs(u.amount||0),1)-1)*100:0;return{average:i,bestInvestment:{name:n.length>0?n[0].name:"Kein Spieler",roi:25.5},worstInvestment:{name:n.length>1?n[1].name:"Kein Spieler",roi:-12.3},recommendation:i>10?"Starke Performance - weitere Investitionen empfohlen":"Vorsicht bei neuen Investitionen - Analyse verbessern"}}function le(s){const n=oe(s),a=Object.keys(n).sort();if(a.length<2)return{monthlyGrowth:0,avgMonthlyIncome:0,volatility:0};const x=n[a[a.length-1]]||0,i=n[a[a.length-2]]||0,m=i!==0?(x-i)/i*100:0,u=a.reduce((r,j)=>r+(n[j]||0),0)/a.length,c=xe(a.map(r=>n[r]||0));return{monthlyGrowth:m,avgMonthlyIncome:u,volatility:c}}function ie(s){const n=s.length>0?s.reduce((a,x)=>a+Math.abs(x.amount||0),0)/12:1e3;return{nextMonth:{expectedIncome:n*1.1,expectedExpenses:n*.7,netForecast:n*.4},quarterlyForecast:{growth:8.5,confidence:75},riskFactors:["Schwankende Spielleistungen","Verletzungsrisiko","Marktvolatilität"]}}function ce(s,n){const a=s.filter(m=>["Strafe","Spielerkauf"].includes(m.type)).reduce((m,u)=>m+Math.abs(u.amount||0),0),x=n.reduce((m,u)=>m+(u.goalsa||0)+(u.goalsb||0),0),i=x>0?a/x:0;return{costPerGoal:i,aekCostPerGoal:i*.6,realCostPerGoal:i*.4}}function de(s,n){const a=s.find(r=>r.team==="AEK")||{balance:0,debt:0},x=s.find(r=>r.team==="Real")||{balance:0,debt:0},i=(a.debt||0)+(x.debt||0),m=(a.balance||0)+(x.balance||0),u=n.reduce((r,j)=>r+(j.value||0),0)*1e6;let c=10;return i>m&&(c-=3),i>u*.1&&(c-=2),m<1e4&&(c-=2),{riskScore:Math.max(0,c)}}function oe(s){return s.reduce((n,a)=>{const x=new Date(a.date),i=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`;return n[i]=(n[i]||0)+Math.abs(a.amount||0),n},{})}function xe(s){if(s.length<2)return 0;const n=s.reduce((i,m)=>i+m,0)/s.length,a=s.reduce((i,m)=>i+Math.pow(m-n,2),0)/s.length,x=Math.sqrt(a);return n!==0?x/n*100:0}function me({selectedTeam:s="both"}){const{data:n}=E("transactions","*",{order:{column:"date",ascending:!1}}),{data:a}=E("finances","*"),{data:x}=E("matches","*"),i=R.useMemo(()=>{var $,B;if(!n||!a||!x)return null;const r=new Date,j=new Date(r.getTime()-30*24*60*60*1e3),M=new Date(r.getTime()-90*24*60*60*1e3),T=(l,g)=>n.filter(f=>{var q,O;const C=l==="both"||l==="AEK"&&(((q=f.description)==null?void 0:q.includes("AEK"))||f.team==="AEK")||l==="Real"&&(((O=f.description)==null?void 0:O.includes("Real"))||f.team==="Real"),G=new Date(f.date)>=g;return C&&G}),w=T(s,j),o=T(s,M),F={transfers:w.filter(l=>{var g,f;return((g=l.type)==null?void 0:g.toLowerCase().includes("transfer"))||((f=l.description)==null?void 0:f.toLowerCase().includes("transfer"))}),prizes:w.filter(l=>{var g,f;return((g=l.type)==null?void 0:g.toLowerCase().includes("preis"))||((f=l.description)==null?void 0:f.toLowerCase().includes("preis"))||l.amount>0}),penalties:w.filter(l=>{var g,f;return((g=l.type)==null?void 0:g.toLowerCase().includes("strafe"))||((f=l.description)==null?void 0:f.toLowerCase().includes("strafe"))||l.amount<0&&Math.abs(l.amount)<=5e3}),other:w.filter(l=>{var g,f,C;return!((g=l.type)!=null&&g.toLowerCase().includes("transfer"))&&!((f=l.type)!=null&&f.toLowerCase().includes("preis"))&&!((C=l.type)!=null&&C.toLowerCase().includes("strafe"))})},y=w.filter(l=>l.amount>0).reduce((l,g)=>l+g.amount,0),S=w.filter(l=>l.amount<0).reduce((l,g)=>l+Math.abs(g.amount),0),z=o.filter(l=>l.amount>0).reduce((l,g)=>l+g.amount,0),K=o.filter(l=>l.amount<0).reduce((l,g)=>l+Math.abs(g.amount),0),D=y-S,I=D>0?"positive":D<0?"negative":"neutral",L=(($=a.find(l=>l.team==="AEK"))==null?void 0:$.balance)||0,V=((B=a.find(l=>l.team==="Real"))==null?void 0:B.balance)||0,P=L+V,b=[];return L<0&&b.push("AEK im Minus"),V<0&&b.push("Real im Minus"),S>y*1.5&&b.push("Ausgaben übersteigen Einnahmen deutlich"),P<5e3&&I==="negative"&&b.push("Niedrige Liquidität bei negativem Trend"),{summary:{monthlyNet:y-S,quarterlyNet:z-K,totalBalance:P,trend:I,riskLevel:b.length>2?"high":b.length>0?"medium":"low"},categories:F,trends:{income:{monthly:y,quarterly:z,avgPerMatch:x.length>0?y/Math.min(x.filter(l=>new Date(l.date)>=j).length,1):0},expenses:{monthly:S,quarterly:K,avgPerMatch:x.length>0?S/Math.min(x.filter(l=>new Date(l.date)>=j).length,1):0}},predictions:{nextMonthBalance:P+D,cashoutRisk:P<Math.abs(D)*2,recommendedReserve:Math.max(S*2,1e4)},risks:b}},[n,a,x,s]);if(!i)return null;const m=r=>{switch(r){case"high":return"text-red-600 bg-red-50 border-red-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},u=r=>{switch(r){case"positive":return"📈";case"negative":return"📉";default:return"➡️"}},c=r=>`${r>0?"+":""}${r.toLocaleString("de-DE")}€`;return e.jsxs("div",{className:"bg-bg-primary border border-border-light rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-border-light",children:e.jsxs("h3",{className:"text-lg font-semibold text-text-primary flex items-center gap-2",children:[e.jsx("span",{"aria-hidden":"true",children:"🔍"}),"Finanz-Insights"]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:`p-3 rounded-lg border ${m(i.summary.riskLevel)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Risikobewertung"}),e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-white bg-opacity-50",children:i.summary.riskLevel==="high"?"HOCH":i.summary.riskLevel==="medium"?"MITTEL":"NIEDRIG"})]}),i.risks.length>0?e.jsx("ul",{className:"text-sm space-y-1",children:i.risks.map((r,j)=>e.jsxs("li",{children:["• ",r]},j))}):e.jsx("p",{className:"text-sm",children:"Keine kritischen Risiken erkannt"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-text-secondary",children:"30-Tage Saldo"}),e.jsxs("div",{className:"text-lg font-bold flex items-center gap-1",children:[u(i.summary.trend),e.jsx("span",{className:i.summary.monthlyNet>=0?"text-green-600":"text-red-600",children:c(i.summary.monthlyNet)})]})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-text-secondary",children:"Gesamtbalance"}),e.jsx("div",{className:"text-lg font-bold",children:e.jsx("span",{className:i.summary.totalBalance>=0?"text-green-600":"text-red-600",children:c(i.summary.totalBalance)})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Ausgabenkategorien (30 Tage)"}),e.jsx("div",{className:"space-y-2",children:Object.entries(i.categories).map(([r,j])=>{const M=j.reduce((w,o)=>w+(o.amount||0),0),T=j.length;return T===0?null:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-bg-secondary rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium capitalize",children:r==="transfers"?"Transfers":r==="prizes"?"Preisgelder":r==="penalties"?"Strafen":"Sonstiges"}),e.jsxs("span",{className:"text-sm text-text-secondary ml-2",children:["(",T," Transaktionen)"]})]}),e.jsx("span",{className:`font-bold ${M>=0?"text-green-600":"text-red-600"}`,children:c(M)})]},r)})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Prognosen"}),e.jsxs("div",{className:"text-sm space-y-1 text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nächster Monat:"})," ",c(i.predictions.nextMonthBalance)," erwartet"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Empfohlene Reserve:"})," ",c(i.predictions.recommendedReserve)]}),i.predictions.cashoutRisk&&e.jsx("div",{className:"text-red-600 font-medium",children:"⚠️ Liquiditätsrisiko in den nächsten Monaten"})]})]})]})]})}function pe({onNavigate:s}){const[n,a]=R.useState("AEK"),[x,i]=R.useState(new Set),[m,u]=R.useState(!1),[c,r]=R.useState("overview"),[j,M]=R.useState([]),{data:T,loading:w}=E("finances","*"),{data:o,loading:F}=E("transactions","*",{order:{column:"id",ascending:!1}}),{data:y,loading:S}=E("matches","*",{order:{column:"id",ascending:!1}}),{data:z,loading:K}=E("players","*"),D=w||F||S||K,I=t=>T?T.find(d=>d.team===t)||{balance:0,debt:0}:{balance:0,debt:0},L=t=>z?z.filter(d=>d.team===t).reduce((d,h)=>d+(h.value||0),0):0,V=()=>{const t=I("AEK").balance||0,d=I("Real").balance||0,h=L("AEK"),A=L("Real"),p=h*1e6,k=A*1e6;return Math.round(t+d+p+k)},P=t=>o?o.filter(d=>d.team===t):[],b=t=>{const d=Math.round(t||0);return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d)},$=t=>`${(t||0).toFixed(1)}M €`,B=t=>{switch(t){case"Preisgeld":return"🏆";case"Sonstiges":return"📈";case"Strafe":return"📉";case"Spielerkauf":return"👤";case"Spielerverkauf":return"💰";case"SdS Bonus":return"⭐";case"Echtgeld-Ausgleich":return"💳";case"Echtgeld-Ausgleich (getilgt)":return"✅";default:return"💰"}},l=t=>{const d=[{container:"border-blue-400 bg-blue-50 dark:bg-blue-700",header:"text-blue-800 dark:text-blue-100",accent:"blue-500"},{container:"border-green-600 bg-green-100 dark:bg-green-600",header:"text-green-800 dark:text-green-300",accent:"green-600"},{container:"border-red-500 bg-red-50 dark:bg-red-500",header:"text-red-800 dark:text-red-100",accent:"red-500"},{container:"border-purple-500 bg-purple-100 dark:bg-purple-500",header:"text-purple-700 dark:text-purple-100",accent:"purple-500"},{container:"border-yellow-400 bg-yellow-100 dark:bg-yellow-900",header:"text-yellow-800 dark:text-yellow-300",accent:"yellow-400"}],h=(t-1)%d.length;return d[h]},g=t=>{const d=new Set(x);d.has(t)?d.delete(t):d.add(t),i(d)},f=()=>{if(!o||!y)return{matchGroups:[],nonMatchTransactions:[]};const t=[...y].sort((p,k)=>new Date(k.date)-new Date(p.date)),d=[],h=[],A=new Set(t.map(p=>p.id));for(const p of t){const k=o.filter(v=>v.match_id===p.id);k.length&&d.push({match:p,transactions:k})}return o.forEach(p=>{(!p.match_id||!A.has(p.match_id))&&h.push(p)}),{matchGroups:d,nonMatchTransactions:h}};if(D)return e.jsx(J,{message:"Lade Finanzen..."});const C=I("AEK"),G=I("Real"),q=V(),O=I(n),W=P(n),{matchGroups:H,nonMatchTransactions:U}=f();return e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Finanzen"}),e.jsx("p",{className:"text-text-muted",children:"Team-Budgets und Transaktionsübersicht"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>r("overview"),className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${c==="overview"?"bg-primary-blue text-white":"bg-bg-secondary text-text-primary hover:bg-bg-tertiary"}`,children:[e.jsx("span",{children:"💰"}),e.jsx("span",{className:"hidden sm:inline",children:"Übersicht"})]}),e.jsxs("button",{onClick:()=>r("insights"),className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${c==="insights"?"bg-primary-green text-white":"bg-bg-secondary text-text-primary hover:bg-bg-tertiary"}`,children:[e.jsx("span",{children:"🔍"}),e.jsx("span",{className:"hidden sm:inline",children:"Insights"})]}),e.jsxs("button",{onClick:()=>r("analytics"),className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${c==="analytics"?"bg-primary-purple text-white":"bg-bg-secondary text-text-primary hover:bg-bg-tertiary"}`,children:[e.jsx("span",{children:"📊"}),e.jsx("span",{className:"hidden sm:inline",children:"Analyse"})]}),e.jsxs("button",{onClick:()=>r("transactions"),className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${c==="transactions"?"bg-primary-red text-white":"bg-bg-secondary text-text-primary hover:bg-bg-tertiary"}`,children:[e.jsx("span",{children:"📋"}),e.jsx("span",{className:"hidden sm:inline",children:"Transaktionen"})]})]}),c==="analytics"?e.jsx(Z,{}):c==="insights"?e.jsx("div",{className:"space-y-6",children:e.jsx(me,{selectedTeam:n})}):c==="transactions"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{data:o||[],searchFields:["type","description","amount","date"],filterOptions:[{key:"type",label:"Typ",options:[{value:"transfer",label:"Transfer"},{value:"preis",label:"Preisgeld"},{value:"strafe",label:"Strafe"},{value:"sonstige",label:"Sonstige"}],filterFn:(t,d)=>{var p,k;const h=((p=t.type)==null?void 0:p.toLowerCase())||"",A=((k=t.description)==null?void 0:k.toLowerCase())||"";switch(d){case"transfer":return h.includes("transfer")||A.includes("transfer");case"preis":return h.includes("preis")||A.includes("preis")||t.amount>0;case"strafe":return h.includes("strafe")||A.includes("strafe");case"sonstige":return!h.includes("transfer")&&!h.includes("preis")&&!h.includes("strafe");default:return!0}}},{key:"amount",label:"Betrag",options:[{value:"positive",label:"Einnahmen"},{value:"negative",label:"Ausgaben"},{value:"large",label:"Über 1000€"}],filterFn:(t,d)=>{const h=t.amount||0;switch(d){case"positive":return h>0;case"negative":return h<0;case"large":return Math.abs(h)>1e3;default:return!0}}}],onResults:M,placeholder:"Transaktionen durchsuchen..."}),e.jsxs("div",{className:"bg-bg-primary border border-border-light rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-border-light",children:e.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"Alle Transaktionen"})}),e.jsxs("div",{className:"divide-y divide-border-light max-h-96 overflow-y-auto",children:[(j.length>0?j:o||[]).map(t=>e.jsx("div",{className:"p-4 hover:bg-bg-secondary transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-text-primary",children:t.type||"Transaktion"}),e.jsx("span",{className:"text-xs bg-bg-tertiary px-2 py-1 rounded border border-border-light text-text-secondary",children:new Date(t.date).toLocaleDateString("de-DE")})]}),e.jsx("p",{className:"text-sm text-text-secondary truncate mt-1",children:t.description||"Keine Beschreibung"})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:`font-bold ${(t.amount||0)>=0?"text-green-600":"text-red-600"}`,children:[(t.amount||0)>0?"+":"",t.amount||0,"€"]})})]})},t.id)),j.length===0&&(o==null?void 0:o.length)===0&&e.jsxs("div",{className:"p-6 text-center text-text-secondary",children:[e.jsx("div",{className:"text-4xl mb-2",children:"💰"}),e.jsx("p",{children:"Keine Transaktionen gefunden"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"modern-card text-center border-l-4 border-blue-400",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-2",children:"🔵"}),e.jsx("h3",{className:"font-semibold text-blue-600",children:"AEK Athen"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Kontostand: ",e.jsx("span",{className:"font-bold text-blue-600",children:b(C.balance)})]}),e.jsxs("div",{children:["Kaderwert: ",e.jsx("span",{className:"font-bold text-blue-600",children:$(L("AEK"))})]}),e.jsxs("div",{children:["Schulden: ",e.jsx("span",{className:"font-bold text-blue-600",children:b(C.debt||0)})]})]})]}),e.jsxs("div",{className:"modern-card text-center border-l-4 border-red-400",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-2",children:"🔴"}),e.jsx("h3",{className:"font-semibold text-red-600",children:"Real Madrid"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Kontostand: ",e.jsx("span",{className:"font-bold text-red-600",children:b(G.balance)})]}),e.jsxs("div",{children:["Kaderwert: ",e.jsx("span",{className:"font-bold text-red-600",children:$(L("Real"))})]}),e.jsxs("div",{children:["Schulden: ",e.jsx("span",{className:"font-bold text-red-600",children:b(G.debt||0)})]})]})]}),e.jsxs("div",{className:"modern-card text-center border-l-4 border-primary-green",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-2",children:"💰"}),e.jsx("h3",{className:"font-semibold text-primary-green",children:"Gesamt"})]}),e.jsx("div",{className:"text-2xl font-bold text-text-primary",children:b(q)}),e.jsx("div",{className:"text-sm text-text-muted",children:"Gesamtkapital (Bargeld + Kaderwerte)"})]})]}),e.jsxs("div",{className:"modern-card mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"💼"}),"Finanz-Management"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center justify-center space-x-2 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx("span",{children:"📥"}),e.jsx("span",{children:"Export/Import"})]}),e.jsxs("button",{onClick:()=>{const t=C.balance+G.balance,d=(L("AEK")+L("Real"))*1e6,h=t>0?t/q*100:0;_.success(`💰 Finanz-Analyse:

Bargeld: ${b(t)}
Kaderwerte: ${b(d)}
Liquidität: ${h.toFixed(1)}%`,{duration:5e3})},className:"flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx("span",{children:"📊"}),e.jsx("span",{children:"Finanz-Analyse"})]}),e.jsxs("button",{onClick:()=>{const t=(o==null?void 0:o.slice(0,5))||[];if(t.length===0){_.error("Keine Transaktionen vorhanden");return}const d=t.map(h=>`${h.type}: ${b(h.amount)} (${h.team||"Unbekannt"})`).join(`
`);_.success(`📋 Letzte Transaktionen:

${d}`,{duration:6e3})},className:"flex items-center justify-center space-x-2 bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:[e.jsx("span",{children:"📋"}),e.jsx("span",{children:"Letzte Aktivitäten"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Match-Transaktionen"}),H.length>0?e.jsx("div",{className:"space-y-3",children:H.map(({match:t,transactions:d},h)=>{const A=H.length-h,p=l(A),k=!x.has(t.id);return e.jsxs("div",{className:`border-2 ${p.container} rounded-lg shadow-lg`,children:[e.jsxs("button",{onClick:()=>g(t.id),className:"w-full p-3 flex items-center justify-between cursor-pointer hover:bg-opacity-80 transition-all duration-200 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 bg-${p.accent} rounded-full mr-2 flex-shrink-0`}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:`text-lg font-extrabold ${p.header}`,children:["AEK ",t.goalsa||0,":",t.goalsb||0," Real"]}),e.jsx("div",{className:`text-xs font-normal opacity-90 ${p.header}`,children:new Date(t.date).toLocaleDateString("de-DE")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`text-xs bg-${p.accent} text-white px-2 py-1 rounded-full font-semibold`,children:[d.length," Transaktion",d.length!==1?"en":""]}),e.jsx("span",{className:`text-lg font-bold ${p.header} transition-transform duration-200 ${k?"rotate-90":""}`,children:"▶"})]})]}),!k&&e.jsx("div",{className:"p-3 pt-0",children:e.jsx("div",{className:"space-y-2",children:d.map(v=>e.jsx("div",{className:"bg-white bg-opacity-50 rounded-lg p-3 border border-white border-opacity-30",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-xl",children:B(v.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h5",{className:"font-medium text-text-primary",children:v.info||"Transaktion"}),e.jsx("span",{className:`text-sm font-medium ${v.amount>0?"text-primary-green":"text-accent-red"}`,children:v.type})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-text-muted",children:[e.jsxs("span",{className:v.team==="AEK"?"text-blue-600":"text-red-600",children:[v.team==="AEK"?"🔵":"🔴"," ",v.team]}),v.date&&e.jsx("span",{children:new Date(v.date).toLocaleDateString("de-DE")})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-lg font-bold ${v.amount>=0?"text-primary-green":"text-accent-red"}`,children:[v.amount<0?"-":"+",b(Math.abs(v.amount||0))]})})]})},v.id))})})]},t.id)})}):e.jsxs("div",{className:"modern-card text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚽"}),e.jsx("h4",{className:"text-lg font-medium text-text-primary mb-2",children:"Keine Match-Transaktionen"}),e.jsx("p",{className:"text-text-muted",children:"Es wurden noch keine match-bezogenen Transaktionen erfasst."})]})]}),U.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Sonstige Transaktionen"}),e.jsxs("div",{className:"border-2 border-slate-500 bg-slate-100 rounded-lg shadow-lg",children:[e.jsx("div",{className:"p-3 border-b border-slate-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-slate-400 rounded-full mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-extrabold text-slate-700",children:"Sonstige Transaktionen"}),e.jsx("div",{className:"text-xs font-normal opacity-90 text-slate-600",children:"Nicht match-bezogene Buchungen"})]})]}),e.jsxs("div",{className:"text-xs bg-slate-400 text-slate-900 px-2 py-1 rounded-full font-semibold",children:[U.length," Buchung",U.length!==1?"en":""]})]})}),e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"space-y-2",children:U.map(t=>e.jsx("div",{className:"bg-white rounded-lg p-3 border border-slate-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-xl",children:B(t.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h5",{className:"font-medium text-text-primary",children:t.info||"Transaktion"}),e.jsx("span",{className:`text-sm font-medium ${t.amount>0?"text-primary-green":"text-accent-red"}`,children:t.type})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-text-muted",children:[e.jsxs("span",{className:t.team==="AEK"?"text-blue-600":"text-red-600",children:[t.team==="AEK"?"🔵":"🔴"," ",t.team]}),t.date&&e.jsx("span",{children:new Date(t.date).toLocaleDateString("de-DE")})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-lg font-bold ${t.amount>=0?"text-primary-green":"text-accent-red"}`,children:[t.amount<0?"-":"+",b(Math.abs(t.amount||0))]})})]})},t.id))})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:"Team-spezifische Ansicht"}),e.jsx("div",{className:"flex gap-2 mb-4",children:["AEK","Real"].map(t=>e.jsx("button",{onClick:()=>a(t),className:`px-4 py-2 rounded-lg font-medium transition-all ${n===t?t==="AEK"?"bg-blue-600 text-white":"bg-red-600 text-white":"bg-bg-secondary text-text-muted hover:bg-bg-tertiary border border-border-light"}`,children:t==="AEK"?"🔵 AEK Athen":"🔴 Real Madrid"},t))})]}),e.jsxs("div",{className:"modern-card mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-text-primary",children:[n==="AEK"?"🔵 AEK Athen":"🔴 Real Madrid"," - Details"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-text-primary",children:b(O.balance)}),e.jsx("div",{className:"text-sm text-text-muted",children:"Aktueller Kontostand"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-primary-green/10 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-primary-green",children:W.filter(t=>t.amount>0).length}),e.jsx("div",{className:"text-sm text-text-muted",children:"Einnahmen"})]}),e.jsxs("div",{className:"text-center p-3 bg-accent-red/10 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-accent-red",children:W.filter(t=>t.amount<0).length}),e.jsx("div",{className:"text-sm text-text-muted",children:"Ausgaben"})]})]})]}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Hinweis zu Marktwerten"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Spieler-Marktwerte werden in der Datenbank in Millionen Euro gespeichert (z.B. 12.5 = 12,5M €). Für die Gesamtkapital-Berechnung werden diese automatisch in Euro umgerechnet."})]})]})}),e.jsx("div",{className:"mt-6 modern-card bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:e.jsx("i",{className:"fas fa-info-circle"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Transaktionen verwalten"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Um neue Transaktionen hinzuzufügen, nutzen Sie den Verwaltungsbereich."})]})]})}),m&&e.jsx(Q,{onClose:()=>u(!1)})]})]})}export{pe as default};
